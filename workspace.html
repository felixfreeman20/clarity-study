<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Studio Workspace</title>
    
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800;900&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           1. DESIGN TOKENS & CORE VARIABLES
           ========================================================================== */
        :root {
            /* COLOR PALETTE - HIGH CONTRAST */
            --c-canvas: #ffffff;
            --c-ink: #050505;        /* Pure Black text */
            --c-ink-sub: #333333;    /* Dark Grey text (readable) */
            --c-accent: #000000;
            --c-border: #e0e0e0;
            --c-border-focus: #000000;
            --c-surface: #f8f8f8;
            --c-surface-hover: #f0f0f0;
            --c-danger: #ef4444;

            /* DIMENSIONS */
            --sidebar-w: 280px;
            --radius-lg: 24px;
            --radius-xl: 40px;
            
            /* ANIMATION */
            --ease-snap: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ==========================================================================
           2. GLOBAL RESET & TYPOGRAPHY
           ========================================================================== */
        body {
            background-color: var(--c-canvas);
            color: var(--c-ink);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            margin: 0;
            overflow-x: hidden;
        }

        button {
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
        }

        /* SCROLLBAR HIDING */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #000; }

        /* ==========================================================================
           3. SIDEBAR NAVIGATION
           ========================================================================== */
        .app-sidebar {
            position: fixed;
            left: 0; top: 0; bottom: 0;
            width: var(--sidebar-w);
            border-right: 1px solid var(--c-border);
            background: #fff;
            z-index: 50;
            padding: 48px 32px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .brand-lockup {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 64px;
        }

        .brand-mark { width: 20px; height: 20px; background: #000; border-radius: 4px; }
        .brand-text { font-weight: 900; letter-spacing: -0.05em; font-size: 20px; }

        .nav-stack { display: flex; flex-direction: column; gap: 8px; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            border-radius: 16px;
            color: #666;
            font-weight: 700;
            font-size: 14px;
            border: 1px solid transparent;
            background: transparent;
        }

        .nav-item:hover { background: var(--c-surface); color: #000; }
        .nav-item.active { background: #000; color: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .nav-item svg { width: 20px; height: 20px; }

        .user-widget {
            padding-top: 24px;
            border-top: 1px solid var(--c-border);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .avatar-bead {
            width: 40px; height: 40px;
            background: #000; color: #fff;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 16px;
        }

        /* ==========================================================================
           4. MAIN LAYOUT CONTAINER
           ========================================================================== */
        .layout-main {
            margin-left: var(--sidebar-w);
            padding: 80px 60px;
            min-height: 100vh;
            max-width: 1200px;
            margin-right: auto;
        }

        .view-section { display: none; animation: fadeIn 0.6s var(--ease-snap); }
        .view-section.active-view { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ==========================================================================
           5. STUDIO EDITOR COMPONENT
           ========================================================================== */
        .studio-card {
            background: #fff;
            border: 2px solid #000;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.05);
            transition: transform 0.4s var(--ease-snap);
        }

        .studio-card:focus-within { transform: translateY(-4px); box-shadow: 0 30px 60px -15px rgba(0,0,0,0.1); }

        /* Dropzone */
        .file-dropzone {
            padding: 24px;
            background: var(--c-surface);
            border-bottom: 1px solid #eee;
            color: #444;
            font-weight: 800;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
        }
        .file-dropzone:hover { background: #000; color: #fff; }

        /* Toolbar */
        .editor-toolbar {
            padding: 24px 40px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .mode-group {
            display: flex;
            background: #f4f4f5;
            padding: 6px;
            border-radius: 20px;
            gap: 8px;
        }

        .mode-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border-radius: 14px;
            border: none;
            font-weight: 800;
            font-size: 12px;
            text-transform: uppercase;
            color: #666;
            background: transparent;
        }

        .mode-btn svg { width: 18px; height: 18px; stroke-width: 2.5px; }
        .mode-btn:hover { background: rgba(0,0,0,0.05); color: #000; }
        .mode-btn.active { background: #000; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* Quiz Slider Logic */
        .quiz-config {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-left: 20px;
            border-left: 2px solid #eee;
        }

        .slider-wrapper { position: relative; width: 140px; height: 4px; background: #ddd; border-radius: 4px; }
        
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 100%; background: transparent; position: absolute; top: 0; left: 0; z-index: 2; cursor: pointer;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #000; border: 3px solid #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.2); margin-top: 0px;
        }

        .limit-marker {
            position: absolute; left: 20%; top: -6px; width: 2px; height: 16px; background: #ef4444; z-index: 1; pointer-events: none;
        }
        .limit-label {
            position: absolute; left: 20%; top: -20px; font-size: 9px; font-weight: 900; color: #ef4444; transform: translateX(-50%);
        }

        /* Canvas */
        #editor-input {
            width: 100%;
            min-height: 500px;
            padding: 60px 80px;
            font-size: 24px;
            line-height: 1.6;
            font-weight: 500;
            color: #111;
            border: none;
            outline: none;
            resize: none;
            text-align: center;
        }
        #editor-input::placeholder { color: #ccc; }

        /* Generate Button */
        .generate-wrapper {
            display: flex; justify-content: center; margin-top: -30px; position: relative; z-index: 10;
        }
        .btn-generate {
            background: #000; color: #fff;
            padding: 24px 64px; border-radius: 100px;
            font-weight: 900; font-size: 15px; letter-spacing: 0.1em;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 12px;
            border: 4px solid #fff;
        }
        .btn-generate:hover { transform: scale(1.05); box-shadow: 0 30px 60px rgba(0,0,0,0.3); }

        /* ==========================================================================
           6. PRO PAGE (FEATURE GRID)
           ========================================================================== */
        .pro-hero { text-align: center; margin-bottom: 80px; }
        .pro-hero h1 { font-size: 64px; font-weight: 900; letter-spacing: -0.04em; margin-bottom: 20px; line-height: 1; }
        .pro-hero p { font-size: 20px; color: #444; max-width: 600px; margin: 0 auto; }

        .feature-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 60px;
        }

        .feature-card {
            padding: 40px; border-radius: 32px; background: #f9f9f9; border: 1px solid #eee; transition: 0.3s;
        }
        .feature-card:hover { background: #fff; box-shadow: 0 20px 40px rgba(0,0,0,0.05); border-color: #000; }
        .feature-card h3 { font-size: 20px; font-weight: 800; margin-bottom: 12px; }
        .feature-card p { font-size: 14px; color: #555; line-height: 1.6; }

        .pricing-bar {
            background: #000; color: #fff; border-radius: 40px; padding: 60px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .price-tag { font-size: 56px; font-weight: 900; letter-spacing: -0.05em; }

        /* ==========================================================================
           7. MODALS & UTILITIES
           ========================================================================== */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .modal-card {
            background: #fff; width: 450px; border: 3px solid #000; border-radius: 40px; padding: 60px 40px;
            text-align: center; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.2); position: relative;
        }

        .hidden { display: none !important; }
        .results-area { max-width: 800px; margin: 80px auto; display: none; }
        .results-area h2 { font-size: 42px; font-weight: 900; margin-bottom: 32px; line-height: 1.1; }
        .results-area p { font-size: 20px; line-height: 1.7; color: #333; margin-bottom: 24px; }
        .results-area b { color: #000; font-weight: 800; }

        .synthesis-tag { 
            display: inline-block; background: #000; color: #fff; 
            padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; uppercase; margin-bottom: 24px; 
        }

    </style>
</head>
<body>

    <div id="modal-pro" class="modal-overlay">
        <div class="modal-card">
            <button onclick="closeModal()" style="position: absolute; top: 30px; left: 30px; font-size: 24px; font-weight: 900;">&times;</button>
            <div style="width: 60px; height: 60px; background: #000; border-radius: 20px; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center;">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </div>
            <h3 class="text-3xl font-black mb-4">Pro Access Required</h3>
            <p class="text-gray-600 mb-8 px-4 font-medium">You hit the limit. Unlock Exam Mode, 3,000 word contexts, and the 50-Question Quiz Engine.</p>
            <div class="bg-gray-100 rounded-2xl p-6 mb-8">
                <span class="text-4xl font-black text-black">$4.99</span> <span class="text-gray-500 font-bold">/ month</span>
            </div>
            <button class="bg-black text-white w-full py-5 rounded-full font-black text-sm uppercase tracking-widest hover:scale-105 transition-transform">Unlock Logic Engine</button>
        </div>
    </div>

    <aside class="app-sidebar">
        <div>
            <div class="brand-lockup">
                <div class="brand-mark"></div>
                <div class="brand-text">CLARITY</div>
            </div>
            <nav class="nav-stack">
                <button onclick="navigate('studio')" id="nav-studio" class="nav-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/></svg>
                    Studio
                </button>
                <button onclick="navigate('pro')" id="nav-pro" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    Pro Features
                </button>
                <button onclick="navigate('settings')" id="nav-settings" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                    Settings
                </button>
            </nav>
        </div>
        <div class="user-widget">
            <div class="avatar-bead" id="user-avatar">?</div>
            <div>
                <p id="user-name" class="text-xs font-black uppercase text-black mb-1">Loading...</p>
                <button onclick="handleLogout()" class="text-[10px] font-bold text-gray-400 uppercase hover:text-red-500">Sign Out</button>
            </div>
        </div>
    </aside>

    <main class="layout-main">
        
        <section id="view-studio" class="view-section active-view">
            <div class="studio-card">
                <div class="file-dropzone" onclick="document.getElementById('pdf-upload').click()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 4v16m8-8H4"/></svg>
                    <span id="drop-label">Drop PDF to Sync Context</span>
                    <input type="file" id="pdf-upload" class="hidden" accept=".pdf">
                </div>

                <div class="editor-toolbar">
                    <div class="mode-group">
                        <button class="mode-btn active" onclick="setMode('deep', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            Deep
                        </button>
                        <button class="mode-btn" onclick="setMode('speed', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            Speed
                        </button>
                        <button class="mode-btn" onclick="setMode('quiz', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                            Quiz
                        </button>
                        <button class="mode-btn" onclick="setMode('exam', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Exam
                        </button>
                    </div>

                    <div id="quiz-controls" class="quiz-config hidden">
                        <span id="q-val" class="text-xs font-black w-4">10</span>
                        <div class="slider-wrapper">
                            <div class="limit-marker"></div>
                            <div class="limit-label">PRO</div>
                            <input type="range" id="q-range" min="5" max="50" step="5" value="10">
                        </div>
                    </div>
                    
                    <div id="word-count" class="text-[10px] font-black tracking-widest text-gray-400">0 / 1000</div>
                </div>

                <textarea id="ai-input" placeholder="Paste your lecture notes, essay draft, or research here..."></textarea>
            </div>

            <div class="generate-wrapper">
                <button id="btn-run" class="btn-generate">
                    <span>GENERATE INSIGHT</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                </button>
            </div>

            <div id="result-container" class="results-area">
                <div class="synthesis-tag">ANALYSIS COMPLETE</div>
                <div id="result-content"></div>
            </div>
        </section>

        <section id="view-pro" class="view-section">
            <div class="pro-hero">
                <h1>Unlock the Logic Engine.</h1>
                <p>Clarity Pro removes the guardrails. Process 3,000 words, generate 50-question exams, and access the deep-historical context model.</p>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>3,000 Word Context</h3>
                    <p>Stop splitting your essays. Process entire chapters, legal briefs, and research papers in a single synthesis pass.</p>
                </div>
                <div class="feature-card">
                    <h3>Exam Simulation</h3>
                    <p>Don't just read. Test. Generate timed, graded exams based on your notes to simulate the final pressure.</p>
                </div>
                <div class="feature-card">
                    <h3>Deep History Model</h3>
                    <p>Specialized logic for historical causality. Perfect for linking economic data to political outcomes (e.g., Civil War).</p>
                </div>
            </div>

            <div class="pricing-bar">
                <div class="text-left">
                    <span class="block text-xs font-black uppercase tracking-widest text-gray-400 mb-2">Academic Tier</span>
                    <span class="text-2xl font-bold">Monthly Access</span>
                </div>
                <div class="flex items-center gap-8">
                    <span class="price-tag">$4.99</span>
                    <button class="bg-white text-black px-8 py-4 rounded-full font-black text-sm uppercase tracking-widest hover:scale-105 transition-transform">Get Started</button>
                </div>
            </div>
        </section>

        <section id="view-settings" class="view-section">
            <div class="max-w-xl mx-auto">
                <h2 class="text-4xl font-black mb-12">Settings</h2>
                <div class="border border-gray-200 rounded-3xl p-8 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h4 class="font-bold text-lg">Identity Cache</h4>
                            <p class="text-sm text-gray-500">Local storage for your nickname and session.</p>
                        </div>
                        <button onclick="resetData()" class="text-red-500 font-black text-xs uppercase tracking-widest border border-red-100 px-4 py-2 rounded-lg hover:bg-red-50">Clear Data</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG
        const app = initializeApp({ apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" });
        const auth = getAuth(app);
        const db = getFirestore(app);

        // STATE
        let user = null;
        let mode = 'deep';
        
        // DOM ELEMENTS
        const els = {
            input: document.getElementById('ai-input'),
            wordCount: document.getElementById('word-count'),
            quizCtrl: document.getElementById('quiz-controls'),
            slider: document.getElementById('q-range'),
            sliderVal: document.getElementById('q-val'),
            resultBox: document.getElementById('result-container'),
            resultContent: document.getElementById('result-content'),
            modal: document.getElementById('modal-pro')
        };

        // AUTH LISTENER
        onAuthStateChanged(auth, async (u) => {
            if(!u) return window.location.href="index.html";
            const snap = await getDoc(doc(db, "users", u.uid));
            if(snap.exists()){
                user = snap.data();
                document.getElementById('user-name').innerText = user.nickname || "Student";
                document.getElementById('user-avatar').innerText = (user.nickname || "S").charAt(0).toUpperCase();
            }
        });

        // INPUT LOGIC
        els.input.addEventListener('input', () => {
            const txt = els.input.value;
            const words = txt.trim() === '' ? 0 : txt.trim().split(/\s+/).length;
            const limit = user?.isPro ? 3000 : 1000;
            
            els.wordCount.innerText = `${words} / ${limit}`;
            
            if(words > limit) {
                els.input.value = txt.split(/\s+/).slice(0, limit).join(" ");
                els.wordCount.style.color = "red";
            } else {
                els.wordCount.style.color = "#aaa";
            }
        });

        // SLIDER LOGIC (PRO LOCK)
        els.slider.addEventListener('input', (e) => {
            let val = parseInt(e.target.value);
            // Snap back logic for free users
            if(!user?.isPro && val > 10) {
                els.slider.value = 10;
                val = 10;
                window.openModal();
            }
            els.sliderVal.innerText = val;
        });

        // NAVIGATION
        window.navigate = (viewId) => {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.getElementById(`view-${viewId}`).classList.add('active-view');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${viewId}`).classList.add('active');
        };

        // MODE SWITCHING
        window.setMode = (m, btn) => {
            // Exam Mode Lock
            if(m === 'exam' && !user?.isPro) return window.openModal();
            
            mode = m;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Toggle Quiz UI
            if(m === 'quiz') els.quizCtrl.classList.remove('hidden');
            else els.quizCtrl.classList.add('hidden');
        };

        // GENERATION ENGINE (CIVIL WAR TRIGGER)
        document.getElementById('btn-run').addEventListener('click', () => {
            const raw = els.input.value.toLowerCase().trim();
            if(!raw) return;

            els.resultBox.style.display = 'block';
            let html = "";

            // 1. Civil War Logic
            if(raw.includes("civil war") || raw.includes("american civil")) {
                html = `
                    <h2>American Civil War Synthesis</h2>
                    <p>The core of your notes identifies a critical bottleneck: <b>Logistics over Tactics</b>. While you listed the battles of Bull Run and Antietam, the logic engine suggests focusing on the <i>Anaconda Plan</i>.</p>
                    <p><b>Key Connection:</b> The disparity in railroad density (North 3:1 South) made the Confederate interior lines strategy mathematically impossible to sustain long-term.</p>
                    <div style="background:#f4f4f5; padding:20px; border-left:4px solid black; margin:20px 0;">
                        <b>Exam Tip:</b> Don't just list the Emancipation Proclamation as a moral document. Define it as a <i>diplomatic weapon</i> that neutralized British intervention.
                    </div>
                `;
            } 
            // 2. Quiz Logic
            else if(mode === 'quiz') {
                const count = els.slider.value;
                html = `<h2>Generated ${count} Practice Questions</h2>`;
                for(let i=0; i<2; i++) {
                    html += `<div style="margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid #eee;"><p><b>Q${i+1}:</b> Based on the text provided, what is the primary causal factor defined in paragraph 2?</p></div>`;
                }
                html += `<p style="color:#888;"><i>(Simulation limited to 2 items in preview)</i></p>`;
            }
            // 3. Default Logic
            else {
                html = `
                    <h2>Analysis Complete</h2>
                    <p>Your input regarding <b>${els.input.value.split(' ')[0]}</b> has been processed.</p>
                    <p><b>Structural Insight:</b> The text follows a linear narrative. To improve memory retention, try reformatting this data into a causal hierarchy (Cause -> Effect -> Outcome).</p>
                `;
            }

            els.resultContent.innerHTML = html;
            window.scrollTo({ top: els.resultBox.offsetTop - 100, behavior: 'smooth' });
        });

        // UTILS
        window.openModal = () => els.modal.style.display = "flex";
        window.closeModal = () => els.modal.style.display = "none";
        window.handleLogout = () => { if(confirm("Sign out?")) signOut(auth); };
        window.resetData = async () => { 
            if(confirm("Wipe identity cache?")) { 
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" }); 
                location.reload(); 
            } 
        };
        
        // PDF DROP HANDLER
        const dropzone = document.querySelector('.file-dropzone');
        dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.style.background = "#000"; dropzone.style.color="#fff"; });
        dropzone.addEventListener('dragleave', (e) => { e.preventDefault(); dropzone.style.background = "#f8f8f8"; dropzone.style.color="#444"; });
        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.style.background = "#000"; 
            dropzone.style.color="#fff";
            document.getElementById('drop-label').innerText = "CONTEXT SYNCED: " + e.dataTransfer.files[0].name;
        });

    </script>
</body>
</html>
