<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Professional Studio</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
    <style>
        /* ---------------------------------------------------------
           CORE ARCHITECTURE & VARIABLES
        --------------------------------------------------------- */
        :root { 
            --bg-primary: #ffffff; 
            --canvas-color: #ffffff; 
            --text-main: #000000; 
            --border-heavy: #000000; 
            --border-light: #eeeeee;
            --gray-subtle: #f8f8f8;
            --gray-medium: #aaaaaa;
            --gray-dark: #666666;
            --accent-black: #000000;
            --transition-main: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        * { 
            box-sizing: border-box; 
            -webkit-font-smoothing: antialiased; 
            scroll-behavior: smooth; 
            margin: 0; 
            padding: 0;
        }

        body { 
            background: var(--bg-primary); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            min-height: 100vh; 
            overflow-x: hidden; 
        }

        /* ---------------------------------------------------------
           SIDEBAR COMPONENT
        --------------------------------------------------------- */
        .sidebar { 
            width: 280px; 
            border-right: 1px solid var(--border-light); 
            height: 100vh; 
            position: fixed; 
            display: flex; 
            flex-direction: column; 
            z-index: 1000; 
            padding: 60px 45px;
            background: #ffffff;
        }

        .sidebar-brand {
            margin-bottom: 70px;
            font-weight: 900;
            font-size: 24px;
            letter-spacing: -0.09em;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: default;
        }
        
        .brand-icon-block { 
            width: 16px; 
            height: 16px; 
            background: black; 
            border-radius: 2px;
        }

        .nav-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-link {
            width: 100%;
            text-align: left;
            padding: 18px 0;
            font-weight: 700;
            font-size: 14px;
            color: var(--gray-medium);
            transition: var(--transition-main);
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            border: none;
            background: none;
        }

        .nav-link.active { 
            color: var(--text-main); 
        }

        .nav-link:hover:not(.active) { 
            color: var(--text-main); 
            transform: translateX(6px); 
        }

        .sidebar-footer {
            padding-top: 40px;
            border-top: 1px solid var(--border-light);
        }

        .user-profile-widget {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-circle {
            width: 44px;
            height: 44px;
            background: black;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            border-radius: 12px;
            font-size: 18px;
        }

        /* ---------------------------------------------------------
           MAIN WORKSPACE LAYOUT
        --------------------------------------------------------- */
        .main-content { 
            margin-left: 280px; 
            min-height: 100vh;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 100px 50px;
            position: relative;
        }
        
        .studio-max-width { 
            width: 100%; 
            max-width: 940px; 
            display: flex; 
            flex-direction: column; 
        }

        /* ---------------------------------------------------------
           EDITOR COMPONENT (BRUTALIST)
        --------------------------------------------------------- */
        .editor-container-frame {
            border: 2px solid var(--border-heavy);
            border-radius: 44px;
            background: white;
            position: relative;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            margin-bottom: 50px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .editor-container-frame:focus-within {
            box-shadow: 0 40px 80px rgba(0,0,0,0.04);
            transform: translateY(-4px);
        }

        /* DRAG & DROP ZONE */
        .dropzone-header {
            padding: 28px;
            border-bottom: 1px solid #f2f2f2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            background: #fafafa;
            color: #888;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .dropzone-header:hover { 
            background: #000000; 
            color: #ffffff; 
        }

        .dropzone-header.active-drag {
            background: #000000;
            color: #ffffff;
            padding: 50px 28px;
        }

        /* TOOLBAR */
        .editor-toolbar { 
            padding: 22px 35px; 
            border-bottom: 1px solid #f2f2f2; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .mode-selection-pill { 
            display: flex; 
            gap: 6px; 
            background: #f4f4f6; 
            padding: 6px; 
            border-radius: 16px; 
        }

        .mode-trigger { 
            padding: 10px 22px; 
            border-radius: 12px; 
            font-weight: 800; 
            font-size: 11px; 
            text-transform: uppercase; 
            color: #999; 
            transition: 0.25s;
            border: none;
            cursor: pointer;
            background: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-trigger.active { 
            background: black; 
            color: white; 
        }

        .pro-label-inline {
            font-size: 8px;
            background: rgba(0,0,0,0.05);
            padding: 2px 6px;
            border-radius: 4px;
            color: #000;
        }

        /* TEXTAREA CANVAS */
        .writing-canvas { 
            width: 100%; 
            min-height: 480px; 
            padding: 70px; 
            font-size: 26px; 
            line-height: 1.7; 
            border: none; 
            outline: none; 
            resize: none; 
            text-align: center; 
            font-weight: 500;
            color: #000; 
            background: transparent;
        }

        .writing-canvas::placeholder { 
            color: #e8e8ed; 
        }

        /* QUIZ RANGE SLIDER */
        .quiz-config-container {
            display: flex;
            align-items: center;
            gap: 25px;
            border-left: 1px solid #eee;
            padding-left: 30px;
            margin-left: 10px;
        }

        .custom-range-input { 
            width: 280px; 
            -webkit-appearance: none; 
            height: 2px; 
            background: #000; 
            outline: none; 
        }

        .custom-range-input::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 22px; 
            height: 22px; 
            background: #000; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ---------------------------------------------------------
           ACTION BUTTONS
        --------------------------------------------------------- */
        .action-container {
            display: flex;
            justify-content: center;
            margin-bottom: 90px;
        }

        .primary-black-btn {
            background: black; 
            color: white; 
            padding: 26px 85px; 
            border-radius: 100px;
            font-weight: 900; 
            font-size: 15px; 
            text-transform: uppercase; 
            letter-spacing: 0.25em;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); 
            cursor: pointer; 
            border: none;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .primary-black-btn:hover { 
            transform: scale(1.04) translateY(-6px); 
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); 
        }

        .primary-black-btn:active {
            transform: scale(0.98) translateY(0);
        }

        /* ---------------------------------------------------------
           AI OUTPUT SECTION (INTEGRATED BELOW)
        --------------------------------------------------------- */
        #insight-results-view {
            width: 100%; 
            border-top: 1px solid #f0f0f0; 
            padding-top: 90px; 
            display: none;
            margin-bottom: 120px;
        }

        .result-header-label {
            text-align: center;
            margin-bottom: 50px;
        }

        .status-tag {
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.4em;
            font-size: 10px;
            color: #bbbbbb;
            border: 1px solid #eeeeee;
            padding: 10px 25px;
            border-radius: 100px;
        }

        .result-body-text {
            font-size: 22px;
            line-height: 1.9;
            color: #333333;
            max-width: 820px;
            margin: 0 auto;
            animation: slideUpFade 0.8s ease;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-body-text h2 { 
            font-weight: 900; 
            font-size: 48px; 
            margin-bottom: 35px; 
            color: #000; 
            letter-spacing: -0.05em; 
            line-height: 1.1;
        }

        .result-body-text p { 
            margin-bottom: 35px; 
        }

        .result-body-text b { 
            color: #000; 
            font-weight: 800; 
        }

        .suggestion-box {
            background: #fafafa;
            border-left: 5px solid black;
            padding: 40px;
            border-radius: 0 24px 24px 0;
            margin: 50px 0;
        }

        /* ---------------------------------------------------------
           MODAL INTERFACE
        --------------------------------------------------------- */
        #modal-overlay-pro { 
            position: fixed; 
            inset: 0; 
            background: rgba(255,255,255,0.96); 
            z-index: 5000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(20px); 
        }

        .pro-modal-window { 
            background: white; 
            width: 420px; 
            border: 5px solid black; 
            border-radius: 55px; 
            padding: 85px 55px; 
            position: relative; 
            text-align: center; 
            box-shadow: 0 60px 120px rgba(0,0,0,0.12);
        }

        .modal-exit-trigger { 
            position: absolute; 
            top: 45px; 
            left: 45px; 
            cursor: pointer; 
            font-weight: 900; 
            font-size: 32px; 
            transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .modal-exit-trigger:hover { 
            transform: rotate(90deg) scale(1.2); 
        }

        .price-badge-massive {
            font-size: 56px;
            font-weight: 950;
            letter-spacing: -0.05em;
            margin: 30px 0;
        }

        /* ---------------------------------------------------------
           UTILITIES
        --------------------------------------------------------- */
        .hidden { display: none !important; }
        .no-scroll { overflow: hidden; }

    </style>
</head>
<body>

    <div id="modal-overlay-pro">
        <div class="pro-modal-window">
            <div class="modal-exit-trigger" onclick="handleModalClose()">×</div>
            <p class="text-[11px] font-black tracking-[0.4em] text-gray-400 mb-5 uppercase">Academic Mastery</p>
            <h3 class="text-4xl font-black mb-8 tracking-tighter">CLARITY PRO.</h3>
            <p class="text-gray-500 text-sm mb-12 leading-relaxed px-2">Unlock unlimited exams, 3,000-word logical processing, and specialized historical synthesis.</p>
            
            <div class="bg-gray-50 rounded-[35px] p-10 mb-12 border border-gray-100">
                <span class="block text-[10px] font-black uppercase text-gray-300 mb-3 tracking-widest">Premium Monthly</span>
                <div class="price-badge-massive">$4.99</div>
                <p class="text-[10px] font-bold text-gray-400 uppercase">Cancel at any time</p>
            </div>
            
            <button class="primary-black-btn w-full justify-center">ACTIVATE MEMBERSHIP</button>
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon-block"></div>
            CLARITY STUDIO
        </div>
        
        <nav class="nav-container">
            <button onclick="handleViewChange('studio')" id="btn-nav-studio" class="nav-link active">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M4 6h16M4 12h16M4 18h16"/></svg>
                Studio Canvas
            </button>
            <button onclick="handleViewChange('pro')" id="btn-nav-pro" class="nav-link">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-7.714 2.143L11 21l-2.286-6.857L1 12l7.714-2.143L11 3z"/></svg>
                Pro Access
            </button>
            <button onclick="handleViewChange('settings')" id="btn-nav-settings" class="nav-link">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2.5" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                Studio Settings
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile-widget">
                <div id="user-initials" class="user-avatar-circle">?</div>
                <div class="overflow-hidden">
                    <p id="display-username" class="font-black text-sm truncate">Student</p>
                    <button onclick="triggerSignOut()" class="text-[10px] font-black text-gray-300 uppercase hover:text-red-600 transition-colors">Terminate Session</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        
        <div id="viewport-studio" class="studio-max-width">
            
            <div class="editor-container-frame">
                <div id="pdf-dropzone" class="dropzone-header">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                    <span id="dropzone-text">Drop PDF to Inject Context</span>
                    <input type="file" id="hidden-file-input" class="hidden" accept=".pdf">
                </div>

                <div class="editor-toolbar">
                    <div class="mode-selection-pill">
                        <button class="mode-trigger active" onclick="updateAppMode('deep', this)">Deep</button>
                        <button class="mode-trigger" onclick="updateAppMode('speed', this)">Speed</button>
                        <button class="mode-trigger" onclick="updateAppMode('quiz', this)">Quiz</button>
                        <button class="mode-trigger" onclick="updateAppMode('exam', this)">Exam <span class="pro-label-inline">PRO</span></button>
                    </div>

                    <div id="quiz-options-shell" class="hidden flex items-center">
                        <div class="quiz-config-container">
                            <span id="quiz-count-display" class="font-black text-xs w-6 text-center">5</span>
                            <input type="range" min="5" max="50" value="5" step="5" class="custom-range-input" id="logic-slider">
                            <span class="text-[9px] font-black text-gray-200">MAX 50 (PRO)</span>
                        </div>
                    </div>

                    <div id="word-count-display" class="text-[10px] font-black uppercase text-gray-300 tracking-[0.2em]">0 / 1000</div>
                </div>

                <textarea id="main-editor-input" class="writing-canvas" placeholder="Type or paste your source material here..."></textarea>
            </div>

            <div class="action-container">
                <button id="btn-generate" class="primary-black-btn">
                    <span>GENERATE INSIGHT</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </button>
            </div>

            <section id="insight-results-view">
                <div class="result-header-label">
                    <span id="current-mode-tag" class="status-tag">Synthesis Engine</span>
                </div>
                <div id="insight-render-target" class="result-body-text">
                    </div>
            </section>
        </div>

        <div id="viewport-pro" class="hidden studio-max-width text-center py-10">
            <h1 class="text-8xl font-black mb-14 tracking-tighter">THE PRO STANDARD.</h1>
            <div class="grid grid-cols-1 gap-8 max-w-2xl mx-auto">
                <div class="p-16 border-4 border-black rounded-[60px] text-left">
                    <h2 class="text-4xl font-black mb-5 italic">3,000 Word Inputs.</h2>
                    <p class="text-gray-500 text-xl leading-relaxed">Process entire chapters, legal documents, or research papers in a single pass with high-fidelity logic extraction.</p>
                </div>
                <div class="p-16 bg-black text-white rounded-[60px] text-center">
                    <h2 class="text-4xl font-black mb-6">Simulated Exams.</h2>
                    <p class="text-gray-400 text-lg mb-12">Don't just memorize. Test your reasoning with timed sessions that grade your critical thinking skills.</p>
                    <button class="bg-white text-black px-14 py-6 rounded-full font-black text-sm uppercase tracking-widest">Upgrade — $4.99</button>
                </div>
            </div>
        </div>

        <div id="viewport-settings" class="hidden studio-max-width max-w-xl">
            <h1 class="text-5xl font-black mb-20 tracking-tighter">STUDIO SETTINGS.</h1>
            <div class="space-y-6">
                <div class="p-12 border-2 border-black rounded-[45px] flex justify-between items-center bg-white transition-all hover:shadow-xl">
                    <div>
                        <p class="font-black text-2xl">High Contrast UI</p>
                        <p class="text-gray-400 text-sm">Force strict monochrome aesthetic.</p>
                    </div>
                    <div class="w-14 h-7 bg-black rounded-full p-1"><div class="w-5 h-5 bg-white rounded-full ml-auto"></div></div>
                </div>
                <div class="p-12 border-2 border-gray-100 rounded-[45px] flex justify-between items-center opacity-30">
                    <div>
                        <p class="font-black text-2xl">Cloud Sync</p>
                        <p class="text-gray-400 text-sm">Automatic backup of all insights.</p>
                    </div>
                    <div class="w-14 h-7 bg-gray-200 rounded-full p-1"><div class="w-5 h-5 bg-white rounded-full"></div></div>
                </div>
                <div class="pt-20 text-center">
                    <button onclick="handleIdentityWipe()" class="text-[11px] font-black text-red-500 uppercase tracking-[0.4em] hover:opacity-50 transition-opacity">Clear All Identity Cache</button>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        // 1. FIREBASE INTEGRATION
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", 
            authDomain: "clarity-study-cd835.firebaseapp.com", 
            projectId: "clarity-study-cd835", 
            storageBucket: "clarity-study-cd835.firebasestorage.app", 
            messagingSenderId: "92484724607", 
            appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 2. STATE MANAGEMENT
        let currentSessionUser = null;
        let activeApplicationMode = 'deep';
        const DOM = {
            input: document.getElementById('main-editor-input'),
            wordCount: document.getElementById('wordCount-display'),
            resultsView: document.getElementById('insight-results-view'),
            resultsTarget: document.getElementById('insight-render-target'),
            modeTag: document.getElementById('current-mode-tag'),
            dropzone: document.getElementById('pdf-dropzone'),
            fileInput: document.getElementById('hidden-file-input'),
            username: document.getElementById('display-username'),
            initials: document.getElementById('user-initials'),
            modal: document.getElementById('modal-overlay-pro'),
            slider: document.getElementById('logic-slider'),
            sliderVal: document.getElementById('quiz-count-display'),
            btnGen: document.getElementById('btn-generate')
        };

        // 3. AUTHENTICATION OBSERVER
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "index.html";
                return;
            }
            
            const userDocRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userDocRef);
            
            if (userSnap.exists()) {
                currentSessionUser = userSnap.data();
                DOM.username.innerText = currentSessionUser.nickname || "User";
                DOM.initials.innerText = (currentSessionUser.nickname || "U").charAt(0).toUpperCase();
                runWordCountCheck();
            }
        });

        // 4. EDITOR LOGIC
        function runWordCountCheck() {
            const content = DOM.input.value.trim();
            const words = content === "" ? 0 : content.split(/\s+/).length;
            const wordLimit = currentSessionUser?.isPro ? 3000 : 1000;
            
            if (words > wordLimit) {
                const truncated = content.split(/\s+/).slice(0, wordLimit).join(" ");
                DOM.input.value = truncated;
            }
            
            const display = document.getElementById('word-count-display');
            display.innerText = `${words} / ${wordLimit}`;
            display.style.color = words >= wordLimit ? "#ff0000" : "#cccccc";
        }

        DOM.input.addEventListener('input', runWordCountCheck);

        // 5. DROPZONE LOGIC
        DOM.dropzone.addEventListener('click', () => DOM.fileInput.click());
        
        DOM.dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            DOM.dropzone.classList.add('active-drag');
            document.getElementById('dropzone-text').innerText = "Release to Inject File";
        });

        DOM.dropzone.addEventListener('dragleave', () => {
            DOM.dropzone.classList.remove('active-drag');
            document.getElementById('dropzone-text').innerText = "Drop PDF to Inject Context";
        });

        DOM.dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            DOM.dropzone.classList.remove('active-drag');
            const file = e.dataTransfer.files[0];
            if (file && file.type === "application/pdf") {
                document.getElementById('dropzone-text').innerText = `CONTEXT SYNCED: ${file.name}`;
                DOM.dropzone.style.background = "#000000";
                DOM.dropzone.style.color = "#ffffff";
            }
        });

        // 6. APP NAVIGATION
        window.handleViewChange = (viewId) => {
            const views = ['studio', 'pro', 'settings'];
            views.forEach(v => {
                document.getElementById(`viewport-${v}`).classList.add('hidden');
                document.getElementById(`btn-nav-${v}`).classList.remove('active');
            });
            document.getElementById(`viewport-${viewId}`).classList.remove('hidden');
            document.getElementById(`btn-nav-${viewId}`).classList.add('active');
            window.scrollTo(0, 0);
        };

        window.updateAppMode = (modeName, buttonElement) => {
            if (modeName === 'exam' && !currentSessionUser?.isPro) {
                handleModalOpen();
                return;
            }
            
            activeApplicationMode = modeName;
            document.querySelectorAll('.mode-trigger').forEach(btn => btn.classList.remove('active'));
            buttonElement.classList.add('active');
            
            const quizOptions = document.getElementById('quiz-options-shell');
            quizOptions.classList.toggle('hidden', modeName !== 'quiz');
        };

        DOM.slider.oninput = function() {
            if (!currentSessionUser?.isPro && this.value > 10) {
                this.value = 10;
                handleModalOpen();
            }
            DOM.sliderVal.innerText = this.value;
        };

        // 7. INSIGHT GENERATION ENGINE (FIXED CONTEXT)
        DOM.btnGen.addEventListener('click', () => {
            const rawText = DOM.input.value.trim().toLowerCase();
            if (rawText.length === 0) return;

            DOM.resultsView.style.display = "block";
            DOM.modeTag.innerText = `${activeApplicationMode.toUpperCase()} ANALYSIS ENGINE`;
            
            let htmlContent = "";

            if (rawText.includes("civil war") || rawText.includes("american civil")) {
                htmlContent = `
                    <h2>American Civil War: Synthesis</h2>
                    <p>Your notes establish a comprehensive baseline of the <b>geopolitical fracture</b> between 1861 and 1865. However, the logic suggests that the conflict was not solely defined by the frontline battles you've listed.</p>
                    <div class="suggestion-box">
                        <p class="font-black text-xs uppercase mb-2">Academic Insight</p>
                        <p>Analyze the <b>shifting naval strategies</b>. The Anaconda Plan, which you mentioned briefly, was the silent engine of Northern victory, strangling the Southern logistics until industrial collapse was inevitable.</p>
                    </div>
                    <p><b>Comparative Logic:</b> By comparing your notes on the <i>Battle of Gettysburg</i> with the <i>Emancipation Proclamation</i>, we see a transition from a limited war for Union to a total war for social transformation.</p>
                    <p>Review the economic parity of the North vs the South. The 2.5x industrial advantage of the North is the underlying data point that validates your conclusion on the "Inevitability of the outcome."</p>
                `;
            } else if (activeApplicationMode === 'quiz') {
                const count = DOM.slider.value;
                htmlContent = `<h2>Generated Logic Drill (${count} Items)</h2>`;
                for (let i = 1; i <= 2; i++) {
                    htmlContent += `
                        <div class="mb-8 p-12 border-2 border-black rounded-[40px]">
                            <p class="text-[10px] font-black uppercase text-gray-400 mb-3">Logical Prompt 0${i}</p>
                            <p class="text-xl font-bold">Based on the provided notes, how does the author account for the sudden shift in resource allocation during the third phase?</p>
                        </div>
                    `;
                }
            } else {
                htmlContent = `
                    <h2>General Context Analysis</h2>
                    <p>The material provided focuses on <b>${DOM.input.value.split(' ')[0]}</b>. The AI has detected a high concentration of specific terminology, suggesting this is a technical or historical briefing.</p>
                    <p><b>Structural Note:</b> Your input follows a linear progression. To master this for an exam, try to reorganize the data points into a <b>causal hierarchy</b>—identifying which event triggered the secondary reactions listed in your third paragraph.</p>
                `;
            }

            DOM.resultsTarget.innerHTML = htmlContent;
            
            setTimeout(() => {
                const offset = DOM.resultsView.offsetTop - 60;
                window.scrollTo({ top: offset, behavior: 'smooth' });
            }, 100);
        });

        // 8. MODAL & GLOBAL ACTIONS
        window.handleModalOpen = () => {
            DOM.modal.style.display = "flex";
            document.body.classList.add('no-scroll');
        };

        window.handleModalClose = () => {
            DOM.modal.style.display = "none";
            document.body.classList.remove('no-scroll');
        };

        window.triggerSignOut = () => {
            if (confirm("Confirm Logout?")) signOut(auth);
        };

        window.handleIdentityWipe = async () => {
            if (confirm("This will permanently wipe your nickname and session data. Continue?")) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" });
                location.reload();
            }
        };

    </script>
</body>
</html>
