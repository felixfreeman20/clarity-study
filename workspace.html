<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Studio Pro</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #ffffff; 
            --canvas: #ffffff; 
            --text: #000000; 
            --border: #000000; 
            --subtext: #666666; 
            --accent: #000000; 
            --glass: rgba(255, 255, 255, 0.8);
        }
        
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; scroll-behavior: smooth; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; min-height: 100vh; overflow-x: hidden; }

        /* ---------------------------------------------------------
           SIDEBAR ARCHITECTURE (BRUTALIST BLACK)
        --------------------------------------------------------- */
        .sidebar { 
            width: 280px; 
            border-right: 1px solid #eeeeee; 
            height: 100vh; 
            position: fixed; 
            display: flex; 
            flex-direction: column; 
            z-index: 100; 
            padding: 50px 40px;
            background: white;
        }

        .sidebar-brand {
            margin-bottom: 60px;
            font-weight: 900;
            font-size: 22px;
            letter-spacing: -0.08em;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand-square { width: 15px; height: 15px; background: black; }

        .nav-link {
            width: 100%;
            text-align: left;
            padding: 16px 0;
            font-weight: 700;
            font-size: 14px;
            color: #aaaaaa;
            transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
        }
        .nav-link.active { color: var(--text); }
        .nav-link:hover:not(.active) { color: var(--text); transform: translateX(5px); }

        /* ---------------------------------------------------------
           MAIN WORKSPACE
        --------------------------------------------------------- */
        .main-content { 
            margin-left: 280px; 
            min-height: 100vh;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 80px 40px;
        }
        
        .studio-container { 
            width: 100%; 
            max-width: 900px; 
            display: flex; 
            flex-direction: column; 
        }

        /* ---------------------------------------------------------
           INTEGRATED EDITOR & DROPBOX
        --------------------------------------------------------- */
        .editor-container {
            border: 2px solid var(--border);
            border-radius: 40px;
            background: white;
            position: relative;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 0 0 transparent;
            margin-bottom: 40px;
        }
        .editor-container:focus-within {
            box-shadow: 0 30px 60px rgba(0,0,0,0.05);
            transform: translateY(-2px);
        }

        .drop-zone {
            padding: 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: #fafafa;
            color: #999;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            cursor: pointer;
            border-top-left-radius: 38px;
            border-top-right-radius: 38px;
            transition: 0.3s;
        }
        .drop-zone:hover { background: #000; color: #fff; }
        .drop-zone.drag-over { background: #000; color: #fff; padding: 40px; }

        .toolbar { 
            padding: 20px 30px; 
            border-bottom: 1px solid #f0f0f0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .mode-pill { 
            display: flex; 
            gap: 4px; 
            background: #f1f1f3; 
            padding: 5px; 
            border-radius: 14px; 
        }

        .mode-btn { 
            padding: 8px 18px; 
            border-radius: 10px; 
            font-weight: 800; 
            font-size: 10px; 
            text-transform: uppercase;
            color: #999; 
            transition: 0.2s; 
        }
        .mode-btn.active { 
            background: black; 
            color: white; 
        }

        /* ---------------------------------------------------------
           TEXT ENGINE
        --------------------------------------------------------- */
        textarea { 
            width: 100%; 
            min-height: 450px;
            padding: 60px; 
            font-size: 24px; 
            line-height: 1.6; 
            border: none; 
            outline: none; 
            resize: none; 
            text-align: center; 
            font-weight: 500;
            color: #000;
            background: transparent;
        }
        textarea::placeholder { color: #e1e1e6; }

        .slider-wrap { display: flex; align-items: center; gap: 20px; border-left: 1px solid #eee; padding-left: 25px; }
        .slider-long { 
            width: 300px; 
            -webkit-appearance: none; 
            height: 2px; 
            background: #000; 
            outline: none; 
        }
        .slider-long::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 20px; 
            height: 20px; 
            background: #000; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* ---------------------------------------------------------
           GENERATE BUTTON (BLACK)
        --------------------------------------------------------- */
        .gen-trigger-container {
            display: flex;
            justify-content: center;
            margin-bottom: 80px;
        }
        .black-btn {
            background: black;
            color: white;
            padding: 24px 80px;
            border-radius: 100px;
            font-weight: 900;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            cursor: pointer;
            border: none;
        }
        .black-btn:hover { 
            transform: scale(1.05) translateY(-5px); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        /* ---------------------------------------------------------
           INTEGRATED AI RESULT (FLOWS BELOW)
        --------------------------------------------------------- */
        #aiResultSection {
            width: 100%;
            border-top: 1px solid #eee;
            padding-top: 80px;
            display: none;
            animation: fadeIn 0.8s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-meta {
            text-align: center;
            margin-bottom: 40px;
        }
        .result-meta span {
            font-[900] text-[10px] uppercase tracking-[0.4em] text-gray-400 border border-gray-100 px-6 py-2 rounded-full;
        }

        .result-content {
            font-size: 20px;
            line-height: 1.8;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
        }
        .result-content h2 { 
            font-weight: 900; 
            font-size: 42px; 
            margin-bottom: 30px; 
            color: #000; 
            letter-spacing: -0.04em;
            line-height: 1.1;
        }
        .result-content p { margin-bottom: 30px; }
        .result-content b { color: #000; font-weight: 800; }

        .pro-card {
            background: #000;
            color: #fff;
            padding: 60px;
            border-radius: 40px;
            margin-top: 40px;
            text-align: center;
        }

        /* ---------------------------------------------------------
           MODAL (BLACK STYLE)
        --------------------------------------------------------- */
        #proModal { 
            position: fixed; 
            inset: 0; 
            background: rgba(255,255,255,0.95); 
            z-index: 1000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(15px); 
        }
        .modal-card { 
            background: white; 
            width: 400px; 
            border: 4px solid black;
            border-radius: 50px; 
            padding: 80px 50px; 
            position: relative; 
            text-align: center; 
            box-shadow: 0 50px 100px rgba(0,0,0,0.1);
        }
        .close-x { 
            position: absolute; 
            top: 40px; 
            left: 40px; 
            cursor: pointer; 
            font-weight: 900; 
            font-size: 28px; 
            transition: 0.3s;
        }
        .close-x:hover { transform: rotate(90deg); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="proModal">
        <div class="modal-card">
            <div class="close-x" onclick="closeModal()">×</div>
            <div class="text-[10px] font-black tracking-[0.3em] text-gray-400 mb-4 uppercase">Premium Membership</div>
            <h3 class="text-4xl font-black mb-6">CLARITY PRO.</h3>
            <p class="text-gray-500 text-sm mb-12 leading-relaxed">Unlock Simulated Exams, 3,000 word inputs, and unlimited logical synthesis for your career.</p>
            <div class="bg-gray-50 rounded-3xl p-8 mb-12 border border-gray-100">
                <span class="block text-[10px] font-black uppercase text-gray-400 mb-2">Monthly Subscription</span>
                <span class="text-5xl font-black">$4.99 <small class="text-lg font-medium">/ mo</small></span>
            </div>
            <button class="black-btn w-full">UPGRADE NOW</button>
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-brand">
            <div class="brand-square"></div>
            CLARITY STUDIO
        </div>
        
        <nav class="flex-1">
            <div onclick="switchView('studio')" id="tab-studio" class="nav-link active">Studio</div>
            <div onclick="switchView('pro')" id="tab-pro" class="nav-link">Pro Access</div>
            <div onclick="switchView('settings')" id="tab-settings" class="nav-link">Settings</div>
        </nav>

        <div class="pt-10 border-t border-gray-100">
            <div class="flex items-center gap-4">
                <div id="uAvatar" class="w-10 h-10 bg-black text-white flex items-center justify-center font-black rounded-xl">?</div>
                <div>
                    <p id="profileName" class="font-black text-sm">Student</p>
                    <button onclick="logout()" class="text-[9px] font-black text-gray-300 uppercase hover:text-red-500 transition-colors">Sign Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        
        <div id="view-studio" class="studio-container">
            <div class="editor-container">
                <div id="dropBox" class="drop-zone">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M12 4v16m8-8H4"/></svg>
                    <span>Drop PDF File to Sync Context</span>
                    <input type="file" id="pdfFile" class="hidden" accept=".pdf">
                </div>

                <div class="toolbar">
                    <div class="mode-pill">
                        <button class="mode-btn active" onclick="setMode('deep', this)">Deep</button>
                        <button class="mode-btn" onclick="setMode('speed', this)">Speed</button>
                        <button class="mode-btn" onclick="setMode('quiz', this)">Quiz</button>
                        <button class="mode-btn" onclick="setMode('exam', this)">Exam <span class="ml-1 opacity-40">PRO</span></button>
                    </div>

                    <div id="quizContainer" class="hidden flex items-center">
                        <div class="slider-wrap">
                            <span id="sliderVal" class="font-black text-xs w-4">5</span>
                            <input type="range" min="5" max="50" value="5" step="5" class="slider-long" id="qSlider">
                            <span class="text-[8px] font-black text-gray-300">LIMIT 50 (PRO)</span>
                        </div>
                    </div>

                    <div id="wordCountUI" class="text-[9px] font-black uppercase text-gray-300 tracking-widest">0 / 1000</div>
                </div>

                <textarea id="aiInput" placeholder="Paste or drag your notes here to begin..."></textarea>
            </div>

            <div class="gen-trigger-container">
                <button id="genBtn" class="black-btn">GENERATE INSIGHT</button>
            </div>

            <section id="aiResultSection">
                <div class="result-meta">
                    <span id="resTag">Synthesis Mode</span>
                </div>
                <div id="resBody" class="result-content">
                    </div>
            </section>
        </div>

        <div id="view-pro" class="hidden studio-container">
            <h1 class="text-7xl font-black mb-12 tracking-tighter">Everything is Pro.</h1>
            <div class="grid grid-cols-1 gap-6">
                <div class="pro-card">
                    <h2 class="text-4xl font-black mb-4 italic underline">3,000 Word Inputs</h2>
                    <p class="text-gray-400 max-w-lg mx-auto">Upload entire chapters or technical manuals and get deep logic extraction instantly.</p>
                </div>
                <div class="p-20 border-4 border-black rounded-[50px] text-center">
                    <h2 class="text-4xl font-black mb-4">Exam Mode</h2>
                    <p class="text-gray-500 mb-10">Grade your reasoning, not just your memory.</p>
                    <button class="black-btn">Activate for $4.99</button>
                </div>
            </div>
        </div>

        <div id="view-settings" class="hidden studio-container max-w-xl">
            <h1 class="text-4xl font-black mb-16 tracking-tighter">STUDIO SETTINGS.</h1>
            <div class="space-y-4">
                <div class="p-10 border-2 border-black rounded-[40px] flex justify-between items-center">
                    <div>
                        <p class="font-black text-xl">High Contrast</p>
                        <p class="text-sm text-gray-400">Strict monochrome UI.</p>
                    </div>
                    <div class="w-12 h-6 bg-black rounded-full relative"><div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full"></div></div>
                </div>
                <div class="p-10 border-2 border-gray-100 rounded-[40px] flex justify-between items-center opacity-40">
                    <div>
                        <p class="font-black text-xl">Auto-Archive</p>
                        <p class="text-sm text-gray-300">Save sessions to cloud.</p>
                    </div>
                    <div class="w-12 h-6 bg-gray-200 rounded-full relative"><div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full"></div></div>
                </div>
                <div class="pt-10 text-center">
                    <button onclick="resetIdentity()" class="text-[10px] font-black text-red-500 uppercase tracking-[0.4em]">Clear Local Cache</button>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", 
            authDomain: "clarity-study-cd835.firebaseapp.com", 
            projectId: "clarity-study-cd835", 
            storageBucket: "clarity-study-cd835.firebasestorage.app", 
            messagingSenderId: "92484724607", 
            appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userProfile = null;
        let currentMode = 'deep';

        // AUTH INITIALIZATION
        onAuthStateChanged(auth, async (u) => {
            if(!u) return window.location.href="index.html";
            const snap = await getDoc(doc(db, "users", u.uid));
            if(snap.exists()){
                userProfile = snap.data();
                document.getElementById('profileName').innerText = userProfile.nickname || "Student";
                document.getElementById('uAvatar').innerText = (userProfile.nickname || "S").charAt(0).toUpperCase();
            }
        });

        // DROPBOX & FILE LOGIC
        const dropBox = document.getElementById('dropBox');
        const fileInput = document.getElementById('pdfFile');

        dropBox.onclick = () => fileInput.click();
        
        dropBox.ondragover = (e) => {
            e.preventDefault();
            dropBox.classList.add('drag-over');
            dropBox.querySelector('span').innerText = "Drop to Sync Content";
        };
        
        dropBox.ondragleave = () => {
            dropBox.classList.remove('drag-over');
            dropBox.querySelector('span').innerText = "Drop PDF File to Sync Context";
        };

        dropBox.ondrop = (e) => {
            e.preventDefault();
            dropBox.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if(file && file.type === "application/pdf") {
                dropBox.querySelector('span').innerText = `Syncing: ${file.name}`;
                dropBox.style.background = "#000";
                dropBox.style.color = "#fff";
            }
        };

        // EDITOR WORD COUNT
        const textArea = document.getElementById('aiInput');
        const countUI = document.getElementById('wordCountUI');

        textArea.oninput = () => {
            const words = textArea.value.trim().split(/\s+/).filter(w => w.length > 0).length;
            const limit = userProfile?.isPro ? 3000 : 1000;
            if(words > limit) {
                textArea.value = textArea.value.split(/\s+/).slice(0, limit).join(" ");
            }
            countUI.innerText = `${words} / ${limit}`;
            countUI.style.color = words >= limit ? "red" : "#ccc";
        };

        // NAVIGATION & MODES
        window.switchView = (v) => {
            ['studio', 'pro', 'settings'].forEach(x => {
                document.getElementById(`view-${x}`).classList.toggle('hidden', x !== v);
                document.getElementById(`tab-${x}`).classList.toggle('active', x === v);
            });
            window.scrollTo(0,0);
        };

        window.setMode = (m, btn) => {
            if(m === 'exam' && !userProfile?.isPro) return openModal();
            currentMode = m;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('quizContainer').classList.toggle('hidden', m !== 'quiz');
        };

        document.getElementById('qSlider').oninput = function() {
            if(!userProfile?.isPro && this.value > 10) {
                this.value = 10;
                openModal();
            }
            document.getElementById('sliderVal').innerText = this.value;
        };

        // GENERATION LOGIC (INTEGRATED)
        document.getElementById('genBtn').onclick = () => {
            if(!textArea.value.trim()) return;
            
            const section = document.getElementById('aiResultSection');
            const body = document.getElementById('resBody');
            const tag = document.getElementById('resTag');
            
            section.style.display = "block";
            tag.innerText = `${currentMode.toUpperCase()} ANALYSIS`;

            // Logic Simulation
            if(currentMode === 'speed') {
                body.innerHTML = `
                    <h2>Executive Summary</h2>
                    <p>The core of your notes identifies a critical <b>bottleneck in infrastructure</b>. The text suggests that without a primary overhaul of the current routing system, the predicted 20% growth is mathematically impossible.</p>
                    <p>Focus on the 'Efficiency Paradox' mentioned in paragraph 3—this is the key to your upcoming assessment.</p>
                `;
            } else if(currentMode === 'quiz') {
                const qNum = document.getElementById('qSlider').value;
                body.innerHTML = `<h2>Generated Practice Session (${qNum} Questions)</h2>`;
                for(let i=1; i<=2; i++){
                    body.innerHTML += `
                        <div class="mb-10 p-10 border border-black rounded-[30px]">
                            <p class="text-[10px] font-black uppercase mb-2">Question 0${i}</p>
                            <p class="text-xl font-bold">How does the author justify the use of "variable-rate" logic in the conclusion of the notes?</p>
                        </div>
                    `;
                }
            } else {
                body.innerHTML = `
                    <h2>Deep Logical Synthesis</h2>
                    <p>Your notes present a high-level overview of <b>systemic collapse</b>. However, the AI has identified a deeper thread: the correlation between <b>asset liquidity</b> and <b>consumer confidence</b> that you didn't explicitly state.</p>
                    <p>By connecting your notes on 'The Great Depression' with your later points on '21st Century Fintech,' we can derive a pattern of <b>Hyper-Inflation Cycles</b>.</p>
                    <p><b>Critical Learning Path:</b> Review the concept of 'Velocity of Money.' Your notes touch on it, but the exam will require you to apply it to the specific data points you've pasted here.</p>
                `;
            }

            // Smooth Scroll to Result
            setTimeout(() => {
                window.scrollTo({ top: section.offsetTop - 50, behavior: 'smooth' });
            }, 100);
        };

        // MODAL INTERFACE
        window.openModal = () => document.getElementById('proModal').style.display = "flex";
        window.closeModal = () => document.getElementById('proModal').style.display = "none";

        window.logout = () => signOut(auth);
        window.resetIdentity = async () => { 
            if(confirm("Wipe all local identity data?")) { 
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" }); 
                location.reload(); 
            } 
        };

    </script>
</body>
</html>
