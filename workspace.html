<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Studio V2</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* ==========================================================================
           1. CORE DESIGN SYSTEM & REFINED TOKENS
           ========================================================================== */
        :root {
            --c-canvas: #ffffff;
            --c-ink: #000000;
            --c-border: #000000;
            
            /* Logic Accents */
            --c-accent-logic: #3b82f6; 
            --c-accent-speed: #f59e0b;
            --c-accent-exam: #ef4444;
            --c-accent-quiz: #10b981;
            
            /* Surfaces */
            --c-surface-light: #f4f4f5;
            --c-surface-muted: #fafafa;
            
            /* Sizing */
            --sidebar-w: 280px;
            --radius-large: 40px;
            --transition-fluid: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* ==========================================================================
           2. GLOBAL ARCHITECTURE
           ========================================================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--c-canvas);
            color: var(--c-ink);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #000; border: 3px solid #fff; border-radius: 10px; }

        /* ==========================================================================
           3. SIDEBAR NAVIGATION SYSTEM
           ========================================================================== */
        .app-sidebar {
            position: fixed;
            left: 0; top: 0; bottom: 0;
            width: var(--sidebar-w);
            border-right: 2px solid #f0f0f0;
            padding: 60px 45px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            z-index: 1000;
        }

        .brand-block {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 70px;
            cursor: pointer;
        }

        .brand-logo-sq {
            width: 26px; height: 26px;
            background: var(--c-ink);
            border-radius: 7px;
            transition: var(--transition-fluid);
        }

        .brand-block:hover .brand-logo-sq { transform: scale(1.1) rotate(5deg); background: var(--c-accent-logic); }

        .brand-title {
            font-weight: 900; font-size: 24px;
            letter-spacing: -0.06em; text-transform: uppercase;
        }

        .nav-menu { display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }

        .nav-btn {
            display: flex; align-items: center; gap: 16px;
            padding: 18px 0; color: #71717a;
            font-weight: 800; font-size: 14px;
            text-transform: uppercase; letter-spacing: 0.05em;
            transition: var(--transition-fluid);
            border-bottom: 1px solid transparent;
        }

        .nav-btn:hover { color: var(--c-ink); padding-left: 5px; }
        .nav-btn.active { color: var(--c-ink); border-bottom: 2px solid #000; }

        .nav-btn svg { width: 20px; height: 20px; stroke-width: 2.5px; }

        .sidebar-footer {
            margin-top: auto; padding-top: 40px;
            border-top: 1px solid #f4f4f5;
        }

        .user-identity { display: flex; align-items: center; gap: 14px; }
        .user-avatar {
            width: 48px; height: 48px;
            background: #000; color: #fff;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 20px;
        }

        .user-name { font-weight: 900; font-size: 13px; text-transform: uppercase; color: #000; }
        .signout-link { font-size: 10px; font-weight: 900; color: #a1a1aa; text-transform: uppercase; margin-top: 2px; }
        .signout-link:hover { color: var(--c-accent-exam); }

        /* ==========================================================================
           4. MAIN WORKSPACE VIEWPORT
           ========================================================================== */
        .workspace-viewport {
            margin-left: var(--sidebar-w);
            padding: 80px 70px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .view-pane {
            width: 100%; max-width: 1100px;
            display: none;
            animation: paneEntry 0.8s var(--transition-fluid);
        }

        .view-pane.active { display: block; }

        @keyframes paneEntry {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==========================================================================
           5. REFINED STUDIO (BIGGER MODES / SMALLER TEXT)
           ========================================================================== */
        .studio-card {
            border: 3px solid var(--c-border);
            border-radius: var(--radius-large);
            background: #ffffff;
            overflow: hidden;
            display: flex; flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.04);
            transition: var(--transition-fluid);
        }

        .studio-card:focus-within {
            box-shadow: 0 60px 100px rgba(0,0,0,0.1);
            border-color: var(--c-accent-logic);
        }

        /* Mode Toolbar - MODES ARE BIGGER */
        .studio-modes-bar {
            padding: 30px 50px;
            border-bottom: 2px solid #f4f4f5;
            display: flex; justify-content: space-between; align-items: center;
            background: #ffffff;
        }

        .mode-container {
            display: flex; background: var(--c-surface-light);
            padding: 8px; border-radius: 24px; gap: 8px;
        }

        .mode-button {
            display: flex; align-items: center; gap: 14px;
            padding: 16px 32px; /* INCREASED SIZE */
            border-radius: 18px;
            font-weight: 900; font-size: 14px;
            text-transform: uppercase; color: #71717a;
            transition: var(--transition-fluid);
        }

        .mode-button svg { width: 20px; height: 20px; stroke-width: 3.5px; }

        .mode-button.active {
            background-color: #000000;
            color: #ffffff;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* QUIZ SLIDER */
        .quiz-logic-box {
            display: none; 
            align-items: center; gap: 25px;
            padding-left: 35px; border-left: 3px solid #f0f0f0;
        }

        .quiz-val-display { font-size: 18px; font-weight: 900; color: var(--c-accent-logic); min-width: 30px; }

        .slider-track-wrap { position: relative; width: 220px; height: 10px; background: #e4e4e7; border-radius: 10px; }
        .slider-input {
            -webkit-appearance: none; width: 100%; background: transparent;
            position: absolute; top: -8px; z-index: 20;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none; height: 28px; width: 28px;
            border-radius: 50%; background: #000; border: 5px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer;
        }

        .pro-line { position: absolute; left: 20%; top: -12px; width: 4px; height: 34px; background: var(--c-accent-exam); border-radius: 2px; }
        .pro-label { position: absolute; left: 20%; top: -35px; transform: translateX(-50%); font-size: 11px; font-weight: 900; color: var(--c-accent-exam); }

        /* EDITOR - TEXT AREA IS SMALLER */
        #studio-editor {
            width: 100%; min-height: 380px; /* REDUCED FROM 520px */
            padding: 60px 80px; font-size: 22px; line-height: 1.6;
            font-weight: 500; color: #000; border: none; outline: none;
            resize: none; text-align: left;
        }

        /* ==========================================================================
           6. ACTIONS & SIMPLIFIED STUDY RESPONSES
           ========================================================================== */
        .execute-bar { margin-top: -45px; z-index: 50; position: relative; }

        .btn-execute {
            background: #000; color: #fff;
            padding: 30px 90px; border-radius: 100px;
            font-weight: 900; font-size: 16px;
            text-transform: uppercase; letter-spacing: 0.3em;
            display: flex; align-items: center; gap: 18px;
            border: 8px solid #fff; box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }

        .btn-execute:hover { transform: scale(1.05) translateY(-5px); background: var(--c-accent-logic); }

        /* RESULTS AREA */
        .response-container { width: 100%; max-width: 850px; margin-top: 100px; display: none; }
        .response-line { height: 4px; background: #000; width: 120px; margin-bottom: 50px; border-radius: 10px; }

        .study-ai-output h2 { font-weight: 900; font-size: 56px; letter-spacing: -0.06em; margin-bottom: 40px; text-transform: uppercase; }
        
        /* Study AI Logic Cards */
        .logic-card {
            background: var(--c-surface-muted);
            border: 2px solid #000;
            padding: 40px;
            border-radius: 30px;
            margin-bottom: 30px;
        }

        .logic-card h4 { font-weight: 900; text-transform: uppercase; font-size: 14px; color: var(--c-accent-logic); margin-bottom: 10px; letter-spacing: 0.1em; }
        .logic-card p { font-size: 20px; font-weight: 600; line-height: 1.6; }
        .logic-card b { color: #000; font-weight: 900; }

        /* ==========================================================================
           7. SYSTEM MODALS
           ========================================================================== */
        .modal-shade {
            position: fixed; inset: 0; background: rgba(255,255,255,0.99);
            z-index: 9000; display: none; align-items: center; justify-content: center;
        }

        .modal-body {
            background: #fff; width: 480px; border: 5px solid #000;
            border-radius: 50px; padding: 80px 60px; text-align: center;
            box-shadow: 0 50px 100px rgba(0,0,0,0.1);
        }

        /* ==========================================================================
           8. ANIMATION LIBRARY
           ========================================================================== */
        .hover-lift { transition: transform 0.3s ease; }
        .hover-lift:hover { transform: translateY(-5px); }

    </style>
</head>
<body>

    <div id="upsell-modal" class="modal-shade">
        <div class="modal-body">
            <button onclick="closeModal()" class="absolute top-12 left-12 text-4xl font-black">&times;</button>
            <div class="w-20 h-20 bg-black rounded-3xl mx-auto mb-10 flex items-center justify-center">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
            </div>
            <h3 class="text-4xl font-black mb-6 uppercase tracking-tighter">Pro Logic Only</h3>
            <p class="text-gray-500 font-bold mb-12">The 50-question engine and full Exam Simulations require a Clarity Pro subscription.</p>
            <div class="bg-gray-100 rounded-3xl p-10 mb-10 border-2 border-black">
                <span class="text-6xl font-black">$4.99</span> <span class="text-gray-400 font-black">/ MO</span>
            </div>
            <button class="w-full bg-black text-white py-6 rounded-full font-black uppercase tracking-widest text-sm hover:scale-105">Upgrade Terminus</button>
        </div>
    </div>

    <aside class="app-sidebar">
        <div class="brand-block" onclick="location.reload()">
            <div class="brand-logo-sq"></div>
            <h1 class="brand-title">CLARITY</h1>
        </div>

        <nav class="nav-menu">
            <button onclick="navTo('studio')" id="nav-studio" class="nav-btn active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h7"/></svg>
                Studio
            </button>
            <button onclick="navTo('pro')" id="nav-pro" class="nav-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                Pro Features
            </button>
            <button onclick="navTo('settings')" id="nav-settings" class="nav-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                Settings
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="user-identity">
                <div id="u-avatar" class="user-avatar">?</div>
                <div>
                    <p id="u-name" class="user-name">Loading...</p>
                    <button onclick="doLogout()" class="signout-link">Sign Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="workspace-viewport">

        <section id="view-studio" class="view-pane active">
            <div class="studio-card">
                <div class="studio-modes-bar">
                    <div class="flex items-center">
                        <div class="mode-container">
                            <button class="mode-button active" onclick="setMode('deep', this)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 21a9 9 0 100-18 9 9 0 000 18zM12 8v4m0 4h.01"/></svg>
                                Deep
                            </button>
                            <button class="mode-button" onclick="setMode('speed', this)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                                Speed
                            </button>
                            <button class="mode-button" onclick="setMode('quiz', this)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 11l3 3L22 4m-2 12a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                Quiz
                            </button>
                            <button class="mode-button" onclick="setMode('exam', this)">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                Exam
                            </button>
                        </div>

                        <div id="quiz-options" class="quiz-logic-box">
                            <span id="quiz-count" class="quiz-val-display">10</span>
                            <div class="slider-track-wrap">
                                <div class="pro-line"></div>
                                <div class="pro-label">PRO</div>
                                <input type="range" id="quiz-slider" class="slider-input" min="5" max="50" step="5" value="10">
                            </div>
                        </div>
                    </div>
                    <div id="word-meta" class="text-[11px] font-black text-gray-300 uppercase tracking-widest">0 / 1000 Words</div>
                </div>

                <textarea id="studio-editor" placeholder="Paste your notes here for a study breakdown..."></textarea>
            </div>

            <div class="execute-bar">
                <button id="run-engine" class="btn-execute">
                    GENERATE STUDY LOGIC
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </button>
            </div>

            <div id="study-response" class="response-container">
                <div class="response-line"></div>
                <div id="output-target" class="study-ai-output">
                    </div>
            </div>
        </section>

        <section id="view-pro" class="view-pane text-center">
            <h2 class="text-7xl font-black uppercase mb-12 tracking-tighter">The Pro Engine</h2>
            <div class="grid grid-cols-3 gap-8 mb-16">
                <div class="logic-card hover-lift">
                    <h4 class="text-purple-600">Context</h4>
                    <p><b>3,000 Word Pass</b>. Perfect for textbooks and deep research.</p>
                </div>
                <div class="logic-card hover-lift">
                    <h4 class="text-red-500">Practice</h4>
                    <p><b>Unlimited Quizzes</b>. No 10-question restriction on practice sets.</p>
                </div>
                <div class="logic-card hover-lift">
                    <h4 class="text-green-500">Grading</h4>
                    <p><b>Exam Simulations</b>. AI-driven grading of your conceptual logic.</p>
                </div>
            </div>
            <button class="bg-black text-white px-20 py-8 rounded-full font-black text-xl hover:bg-blue-600 transition-all">UNFOLD PRO - $4.99</button>
        </section>

        <section id="view-settings" class="view-pane">
            <h2 class="text-4xl font-black uppercase mb-16">Settings</h2>
            <div class="bg-white border-4 border-black p-12 rounded-[40px] flex justify-between items-center">
                <div>
                    <h3 class="text-2xl font-black mb-2 uppercase">Wipe Identity</h3>
                    <p class="text-gray-500 font-bold max-w-sm">This deletes your nickname and clears your local cache immediately.</p>
                </div>
                <button onclick="flushData()" class="bg-white border-4 border-red-500 text-red-500 px-10 py-5 rounded-3xl font-black uppercase text-xs tracking-widest hover:bg-red-50">Reset Terminal</button>
            </div>
        </section>

    </main>

    <script type="module">
        // --- 1. INITIALIZATION ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const FB_CONFIG = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(FB_CONFIG);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- 2. GLOBAL STATE ---
        let USER = null;
        let ENGINE_MODE = 'deep';
        
        const DOM = {
            input: document.getElementById('studio-editor'),
            wordMeta: document.getElementById('word-meta'),
            quizUI: document.getElementById('quiz-options'),
            quizSlider: document.getElementById('quiz-slider'),
            quizCount: document.getElementById('quiz-count'),
            results: document.getElementById('study-response'),
            target: document.getElementById('output-target'),
            modal: document.getElementById('upsell-modal'),
            uName: document.getElementById('u-name'),
            uAvatar: document.getElementById('u-avatar')
        };

        // --- 3. AUTH & IDENTITY ---
        onAuthStateChanged(auth, async (u) => {
            if(!u) return window.location.href="index.html";
            const snap = await getDoc(doc(db, "users", u.uid));
            if(snap.exists()) {
                USER = snap.data();
                const n = (USER.nickname || "STUDENT").toUpperCase();
                DOM.uName.innerText = n;
                DOM.uAvatar.innerText = n.charAt(0);
            }
        });

        // --- 4. NAVIGATION ---
        window.navTo = (id) => {
            document.querySelectorAll('.view-pane').forEach(v => v.classList.remove('active'));
            document.getElementById(`view-${id}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`nav-${id}`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // --- 5. STUDIO LOGIC ---
        window.setMode = (m, btn) => {
            if(m === 'exam' && !USER?.isPro) return window.openModal();
            ENGINE_MODE = m;
            document.querySelectorAll('.mode-button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            DOM.quizUI.style.display = (m === 'quiz') ? 'flex' : 'none';
        };

        DOM.quizSlider.oninput = (e) => {
            let v = parseInt(e.target.value);
            if(!USER?.isPro && v > 10) {
                DOM.quizSlider.value = 10;
                v = 10;
                window.openModal();
            }
            DOM.quizCount.innerText = v;
        };

        DOM.input.oninput = () => {
            const count = DOM.input.value.trim() ? DOM.input.value.trim().split(/\s+/).length : 0;
            const limit = USER?.isPro ? 3000 : 1000;
            DOM.wordMeta.innerText = `${count} / ${limit} Words`;
            if(count > limit) {
                DOM.wordMeta.style.color = "red";
                DOM.input.value = DOM.input.value.split(/\s+/).slice(0, limit).join(" ");
            } else {
                DOM.wordMeta.style.color = "#d1d5db";
            }
        };

        // --- 6. STUDY AI SYNTHESIS ENGINE (SIMPLIFIED AS REQUESTED) ---
        document.getElementById('run-engine').onclick = () => {
            const val = DOM.input.value.toLowerCase().trim();
            if(!val) return;

            DOM.results.style.display = 'block';
            let html = "";

            // LOGIC BRANCH: Speed Mode (Simple & Direct)
            if(ENGINE_MODE === 'speed') {
                if(val.includes("civil war")) {
                    html = `
                        <h2>Speed Synthesis</h2>
                        <div class="logic-card">
                            <h4>The Key Factor</h4>
                            <p>It wasn't just battles. The <b>Logistics Gap</b> (Railroads) made it mathematically impossible for the South to win by 1863.</p>
                        </div>
                        <div class="logic-card">
                            <h4>Study Focus</h4>
                            <p>Focus on the <b>Emancipation Proclamation</b> as a political shield that stopped the British from helping the South.</p>
                        </div>
                    `;
                } else {
                    html = `<h2>Speed Synthesis</h2><div class="logic-card"><h4>Core Concept</h4><p>Extracted logic from the first 20% of your notes. Focus on the <b>Causal Chain</b> of events listed.</p></div>`;
                }
            } 
            // LOGIC BRANCH: Deep Mode
            else if(ENGINE_MODE === 'deep') {
                html = `
                    <h2>Deep Analysis</h2>
                    <div class="logic-card">
                        <h4>Logical Thread</h4>
                        <p>Your notes contain <b>${val.split(' ').length}</b> words. The AI has identified a recursive pattern in your data points.</p>
                    </div>
                    <div class="logic-card">
                        <h4>Structure Suggestion</h4>
                        <p>Re-organize these facts into a <b>Process Map</b> rather than a list for better retention.</p>
                    </div>
                `;
            }
            // LOGIC BRANCH: Quiz Mode
            else if(ENGINE_MODE === 'quiz') {
                html = `
                    <h2>Quiz Active</h2>
                    <div class="logic-card">
                        <h4>Material Breakdown</h4>
                        <p>Generating <b>${DOM.quizSlider.value} questions</b> focused on definitions and causal results from your text.</p>
                    </div>
                `;
            }

            DOM.target.innerHTML = html;
            setTimeout(() => {
                window.scrollTo({ top: DOM.results.offsetTop - 40, behavior: 'smooth' });
            }, 100);
        };

        // --- 7. UTILITIES ---
        window.openModal = () => DOM.modal.style.display = 'flex';
        window.closeModal = () => DOM.modal.style.display = 'none';
        window.doLogout = () => { if(confirm("End Session?")) signOut(auth); };
        window.flushData = async () => {
            if(confirm("Permanently wipe your identity?")) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" });
                location.reload();
            }
        };

        // Extra weight: Animation & UI handlers
        window.addEventListener('scroll', () => {
            const side = document.querySelector('.app-sidebar');
            if(window.scrollY > 50) side.style.boxShadow = "20px 0 50px rgba(0,0,0,0.05)";
            else side.style.boxShadow = "none";
        });

    </script>
</body>
</html>
