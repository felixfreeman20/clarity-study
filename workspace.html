<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Studio Professional</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================================
           1. ROOT ARCHITECTURE & DESIGN TOKENS
        ========================================================= */
        :root {
            --color-white: #ffffff;
            --color-black: #000000;
            --color-dark-grey: #1a1a1a;
            --color-mid-grey: #444444;
            --color-light-grey: #f5f5f5;
            --color-border: #000000;
            --font-main: 'Inter', sans-serif;
            --transition-speed: 0.4s;
            --transition-curve: cubic-bezier(0.16, 1, 0.3, 1);
            --sidebar-width: 280px;
        }

        /* =========================================================
           2. GLOBAL RESET & BASE STYLES
        ========================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background-color: var(--color-white);
            color: var(--color-black);
            font-family: var(--font-main);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }

        button {
            cursor: pointer;
            font-family: inherit;
            border: none;
            background: none;
            transition: all var(--transition-speed) var(--transition-curve);
        }

        /* =========================================================
           3. SIDEBAR NAVIGATION SYSTEM
        ========================================================= */
        .app-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background-color: var(--color-white);
            border-right: 1px solid #e0e0e0;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        .sidebar-logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 80px;
        }

        .logo-square {
            width: 18px;
            height: 18px;
            background-color: var(--color-black);
        }

        .logo-text {
            font-weight: 900;
            font-size: 20px;
            letter-spacing: -0.05em;
            text-transform: uppercase;
        }

        .nav-menu {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            font-weight: 800;
            font-size: 14px;
            color: var(--color-mid-grey);
            text-transform: none;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .nav-item.active {
            color: var(--color-black);
        }

        .nav-item:hover:not(.active) {
            color: var(--color-black);
            transform: translateX(8px);
        }

        .sidebar-footer {
            padding-top: 30px;
            border-top: 1px solid #f0f0f0;
        }

        .profile-card {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-name-label {
            font-weight: 900;
            font-size: 14px;
            color: var(--color-black);
        }

        .logout-trigger {
            font-size: 10px;
            font-weight: 900;
            color: var(--color-mid-grey);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 4px;
        }

        /* =========================================================
           4. MAIN CONTENT LAYOUT
        ========================================================= */
        .view-wrapper {
            margin-left: var(--sidebar-width);
            padding: 100px 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .content-width-limiter {
            width: 100%;
            max-width: 980px;
        }

        /* =========================================================
           5. THE EDITOR FRAME (BRUTALIST HIGH CONTRAST)
        ========================================================= */
        .studio-frame {
            border: 3px solid var(--color-black);
            border-radius: 40px;
            background: var(--color-white);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-bottom: 60px;
            transition: box-shadow 0.5s var(--transition-curve);
        }

        .studio-frame:focus-within {
            box-shadow: 0 40px 100px rgba(0,0,0,0.08);
        }

        /* --- DROP ZONE --- */
        .upload-zone {
            padding: 30px;
            background-color: #fafafa;
            border-bottom: 1px solid var(--color-black);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            transition: background 0.3s ease;
        }

        .upload-zone:hover {
            background-color: var(--color-black);
            color: var(--color-white);
        }

        .upload-zone span {
            font-weight: 900;
            font-size: 11px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        /* --- TOOLBAR & MODE BUTTONS --- */
        .studio-toolbar {
            padding: 25px 40px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mode-switcher {
            display: flex;
            gap: 10px;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 20px;
        }

        .mode-button-large {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 28px;
            border-radius: 14px;
            font-weight: 900;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--color-mid-grey);
            transition: all 0.3s ease;
        }

        .mode-button-large svg {
            width: 18px;
            height: 18px;
            stroke-width: 3px;
        }

        .mode-button-large.active {
            background-color: var(--color-black);
            color: var(--color-white);
        }

        /* --- TEXTAREA CANVAS --- */
        .editor-canvas {
            width: 100%;
            min-height: 500px;
            padding: 80px;
            font-size: 28px;
            line-height: 1.6;
            font-weight: 600;
            color: var(--color-black);
            border: none;
            outline: none;
            resize: none;
            text-align: center;
            background: transparent;
        }

        .editor-canvas::placeholder {
            color: #dddddd;
        }

        .counter-badge {
            font-weight: 900;
            font-size: 11px;
            letter-spacing: 0.1em;
            color: var(--color-black);
        }

        /* =========================================================
           6. ACTION TRIGGER SYSTEM
        ========================================================= */
        .btn-generate-primary {
            background-color: var(--color-black);
            color: var(--color-white);
            padding: 28px 100px;
            border-radius: 100px;
            font-weight: 900;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            display: block;
            margin: 0 auto;
            transition: transform 0.4s var(--transition-curve), box-shadow 0.4s ease;
        }

        .btn-generate-primary:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }

        /* =========================================================
           7. AI OUTPUT & RESULT RENDERING
        ========================================================= */
        .result-container-integrated {
            width: 100%;
            margin-top: 100px;
            border-top: 3px solid var(--color-black);
            padding: 100px 0;
            display: none;
            animation: slideUp 0.8s var(--transition-curve);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-body-content {
            max-width: 820px;
            margin: 0 auto;
            font-size: 24px;
            line-height: 1.8;
            color: var(--color-dark-grey);
        }

        .result-body-content h2 {
            font-weight: 900;
            font-size: 52px;
            letter-spacing: -0.05em;
            margin-bottom: 40px;
            color: var(--color-black);
        }

        .result-body-content p {
            margin-bottom: 35px;
        }

        .result-body-content b {
            color: var(--color-black);
            font-weight: 900;
        }

        /* =========================================================
           8. PRO MODAL SYSTEM (REFINED BRUTALIST)
        ========================================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.98);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(12px);
        }

        .pro-modal-box {
            background-color: var(--color-white);
            width: 100%;
            max-width: 440px;
            border: 2px solid var(--color-black);
            border-radius: 40px;
            padding: 70px 50px;
            position: relative;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0,0,0,0.1);
        }

        .modal-close-icon {
            position: absolute;
            top: 35px;
            left: 35px;
            font-size: 32px;
            font-weight: 900;
            cursor: pointer;
            line-height: 1;
        }

        .modal-price-tag {
            background-color: var(--color-light-grey);
            padding: 35px;
            border-radius: 30px;
            margin: 40px 0;
        }

        /* =========================================================
           9. VIEW STATES
        ========================================================= */
        .hidden-view {
            display: none !important;
        }

    </style>
</head>
<body>

    <div id="proModalOverlay" class="modal-overlay">
        <div class="pro-modal-box">
            <div class="modal-close-icon" onclick="closeUpgradeModal()">&times;</div>
            <h3 style="font-weight: 900; font-size: 36px; margin-bottom: 15px;">PRO ACCESS</h3>
            <p style="font-weight: 600; color: #555; font-size: 15px; margin-bottom: 10px;">Deep Logic & Exam Mode</p>
            
            <div class="modal-price-tag">
                <span style="display: block; font-weight: 900; font-size: 10px; color: #aaa; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.2em;">Monthly Plan</span>
                <span style="font-weight: 900; font-size: 56px;">$4.99</span>
            </div>
            
            <button class="btn-generate-primary" style="width: 100%;">ACTIVATE NOW</button>
        </div>
    </div>

    <aside class="app-sidebar">
        <div class="sidebar-logo-container">
            <div class="logo-square"></div>
            <div class="logo-text">CLARITY STUDIO</div>
        </div>

        <nav class="nav-menu">
            <button onclick="changeAppView('studio')" id="nav-btn-studio" class="nav-item active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                STUDIO CANVAS
            </button>
            <button onclick="changeAppView('pro')" id="nav-btn-pro" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-7.714 2.143L11 21l-2.286-6.857L1 12l7.714-2.143L11 3z"/></svg>
                PRO FEATURES
            </button>
            <button onclick="changeAppView('settings')" id="nav-btn-settings" class="nav-item">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                SETTINGS
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="profile-card">
                <div style="width: 40px; height: 40px; background: #000; border-radius: 10px; color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 18px;" id="user-avatar">?</div>
                <div>
                    <p id="profile-display-name" class="profile-name-label">STUDENT</p>
                    <button onclick="performSignOut()" class="logout-trigger">Sign Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="view-wrapper">
        
        <div id="view-section-studio" class="content-width-limiter">
            <div class="studio-frame">
                <div class="upload-zone" onclick="document.getElementById('hidden-pdf-input').click()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 4v16m8-8H4"/></svg>
                    <span>Drop PDF File to Sync Logical Context</span>
                    <input type="file" id="hidden-pdf-input" style="display: none;" accept=".pdf">
                </div>

                <div class="studio-toolbar">
                    <div class="mode-switcher">
                        <button class="mode-button-large active" onclick="setStudioMode('deep', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            DEEP
                        </button>
                        <button class="mode-button-large" onclick="setStudioMode('speed', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            SPEED
                        </button>
                        <button class="mode-button-large" onclick="setStudioMode('quiz', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            QUIZ
                        </button>
                        <button class="mode-button-large" onclick="setStudioMode('exam', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                            EXAM
                        </button>
                    </div>
                    <div id="word-counter-ui" class="counter-badge">0 / 1000</div>
                </div>

                <textarea id="studio-main-input" class="editor-canvas" placeholder="Paste or drag your study material here to begin..."></textarea>
            </div>

            <button id="btn-trigger-generation" class="btn-generate-primary">GENERATE INSIGHT</button>

            <section id="studio-result-section" class="result-container-integrated">
                <div class="result-body-content" id="result-render-target">
                    </div>
            </section>
        </div>

        <div id="view-section-pro" class="content-width-limiter hidden-view" style="text-align: center;">
            <h1 style="font-weight: 900; font-size: 80px; margin-bottom: 40px; letter-spacing: -0.05em;">PRO ACCESS.</h1>
            <p style="font-size: 20px; font-weight: 600; color: #666; margin-bottom: 60px;">Unlock the full power of the logical engine.</p>
            <div style="display: grid; grid-template-columns: 1fr; gap: 40px; max-width: 600px; margin: 0 auto;">
                <div style="padding: 60px; border: 3px solid #000; border-radius: 40px; text-align: left;">
                    <h2 style="font-weight: 900; font-size: 32px; margin-bottom: 20px;">3,000 Word Processing</h2>
                    <p style="color: #666; line-height: 1.6;">Process entire chapters or detailed research papers in one go with high-fidelity synthesis.</p>
                </div>
                <div style="padding: 60px; background: #000; color: #fff; border-radius: 40px; text-align: left;">
                    <h2 style="font-weight: 900; font-size: 32px; margin-bottom: 20px;">Exam Simulation</h2>
                    <p style="color: #999; line-height: 1.6; margin-bottom: 40px;">Get timed, graded exams based on your personal notes to prepare for your actual finals.</p>
                    <button class="btn-generate-primary" style="background: #fff; color: #000; width: 100%;">Upgrade â€” $4.99</button>
                </div>
            </div>
        </div>

        <div id="view-section-settings" class="content-width-limiter hidden-view">
            <h1 style="font-weight: 900; font-size: 48px; margin-bottom: 60px; letter-spacing: -0.05em;">STUDIO SETTINGS</h1>
            <div style="padding: 40px; border: 1px solid #eee; border-radius: 30px; margin-bottom: 40px;">
                <p style="font-weight: 900; text-transform: uppercase; letter-spacing: 0.1em; font-size: 11px; margin-bottom: 10px; color: #aaa;">Data Management</p>
                <h3 style="font-weight: 900; font-size: 24px; margin-bottom: 30px;">Identity & Cache</h3>
                <button onclick="wipeLocalIdentity()" style="color: red; font-weight: 900; font-size: 12px; text-transform: uppercase; letter-spacing: 0.2em;">Clear All Local Identity</button>
            </div>
        </div>

    </main>

    <script type="module">
        // --- 10.1 FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- 10.2 CONFIGURATION ---
        const config = {
            apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo",
            authDomain: "clarity-study-cd835.firebaseapp.com",
            projectId: "clarity-study-cd835",
            storageBucket: "clarity-study-cd835.firebasestorage.app",
            messagingSenderId: "92484724607",
            appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a"
        };

        // --- 10.3 INITIALIZATION ---
        const app = initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- 10.4 STATE VARIABLES ---
        let GLOBAL_USER_DATA = null;
        let ACTIVE_STUDIO_MODE = 'deep';

        // --- 10.5 DOM REFERENCE ENGINE ---
        const UI = {
            mainInput: document.getElementById('studio-main-input'),
            wordDisplay: document.getElementById('word-counter-ui'),
            genButton: document.getElementById('btn-trigger-generation'),
            resultSection: document.getElementById('studio-result-section'),
            resultTarget: document.getElementById('result-render-target'),
            userName: document.getElementById('profile-display-name'),
            avatar: document.getElementById('user-avatar'),
            modal: document.getElementById('proModalOverlay')
        };

        // --- 10.6 AUTHENTICATION FLOW ---
        onAuthStateChanged(auth, async (userInstance) => {
            console.log("Clarity Auth: Checking session state...");
            
            if (!userInstance) {
                console.log("No active session. Redirecting...");
                window.location.href = "index.html";
                return;
            }

            try {
                const userReference = doc(db, "users", userInstance.uid);
                const userSnapshot = await getDoc(userReference);
                
                if (userSnapshot.exists()) {
                    GLOBAL_USER_DATA = userSnapshot.data();
                    console.log("User Loaded:", GLOBAL_USER_DATA.nickname);
                    
                    // Update UI components
                    UI.userName.innerText = (GLOBAL_USER_DATA.nickname || "STUDENT").toUpperCase();
                    UI.avatar.innerText = (GLOBAL_USER_DATA.nickname || "S").charAt(0).toUpperCase();
                    
                    updateWordCount();
                } else {
                    console.error("User document missing in Firestore.");
                }
            } catch (error) {
                console.error("Firebase Error:", error.message);
            }
        });

        // --- 10.7 WORD COUNT LOGIC (VERBOSE) ---
        function updateWordCount() {
            const currentContent = UI.mainInput.value.trim();
            let wordCountValue = 0;

            if (currentContent !== "") {
                wordCountValue = currentContent.split(/\s+/).filter(word => word.length > 0).length;
            }

            const maxAllowed = GLOBAL_USER_DATA?.isPro ? 3000 : 1000;

            // Enforce limit
            if (wordCountValue > maxAllowed) {
                const wordsArray = currentContent.split(/\s+/);
                const truncatedText = wordsArray.slice(0, maxAllowed).join(" ");
                UI.mainInput.value = truncatedText;
                wordCountValue = maxAllowed;
            }

            UI.wordDisplay.innerText = `${wordCountValue} / ${maxAllowed}`;
            
            // Visual feedback for limit
            if (wordCountValue >= maxAllowed) {
                UI.wordDisplay.style.color = "red";
            } else {
                UI.wordDisplay.style.color = "black";
            }
        }

        UI.mainInput.addEventListener('input', () => {
            updateWordCount();
        });

        // --- 10.8 APP VIEW ENGINE ---
        window.changeAppView = (targetView) => {
            const viewIds = ['studio', 'pro', 'settings'];
            
            viewIds.forEach(viewId => {
                const element = document.getElementById(`view-section-${viewId}`);
                const navBtn = document.getElementById(`nav-btn-${viewId}`);
                
                if (viewId === targetView) {
                    element.classList.remove('hidden-view');
                    navBtn.classList.add('active');
                } else {
                    element.classList.add('hidden-view');
                    navBtn.classList.remove('active');
                }
            });

            // Reset scroll position on view change
            window.scrollTo(0, 0);
        };

        // --- 10.9 MODE ENGINE ---
        window.setStudioMode = (selectedMode, buttonRef) => {
            console.log("Setting Studio Mode to:", selectedMode);
            
            // Check for PRO lock
            if (selectedMode === 'exam' && !GLOBAL_USER_DATA?.isPro) {
                openUpgradeModal();
                return;
            }

            ACTIVE_STUDIO_MODE = selectedMode;

            // Reset UI states for buttons
            const allModeButtons = document.querySelectorAll('.mode-button-large');
            allModeButtons.forEach(btn => btn.classList.remove('active'));
            
            buttonRef.classList.add('active');
        };

        // --- 10.10 GENERATION LOGIC (CONTEXTUAL) ---
        UI.genButton.onclick = function() {
            const rawContent = UI.mainInput.value.trim().toLowerCase();
            
            if (rawContent.length === 0) {
                alert("Please provide study material first.");
                return;
            }

            console.log("Synthesizing insight in mode:", ACTIVE_STUDIO_MODE);
            
            // Display Section
            UI.resultSection.style.display = "block";
            let outputHtml = "";

            // SPECIFIC CONTEXT: AMERICAN CIVIL WAR
            if (rawContent.includes("civil war") || rawContent.includes("american civil")) {
                outputHtml = `
                    <h2>The American Civil War: Logic Synthesis</h2>
                    <p>Based on your notes, the AI has identified a primary logical thread concerning the <b>Collapse of Confederate Logistics</b>. While the battles were the visible face of the war, your data highlights an underlying economic strangulation.</p>
                    <p><b>Critical Learning Point:</b> Look closer at the <i>Railroad Parity</i>. The North didn't just have more men; they had a 3-to-1 advantage in rail density, making your points about "Southern Mobility" mathematically secondary to Northern supply speed.</p>
                    <p>By connecting the <b>Emancipation Proclamation</b> to your notes on British diplomacy, we see that the war transitioned from a territorial dispute to an ideological conflict, effectively ending Southern hopes for European intervention.</p>
                `;
            } else if (ACTIVE_STUDIO_MODE === 'speed') {
                outputHtml = `
                    <h2>Executive Summary</h2>
                    <p>I've extracted the core logic from your input regarding <b>${UI.mainInput.value.split(' ')[0]}</b>.</p>
                    <p>Focus your attention on the <b>Third Paragraph</b>. The causal relationship you listed there between Resource A and Result B is the most likely topic for a synthesis question on your exam.</p>
                `;
            } else {
                outputHtml = `
                    <h2>Synthesis Complete</h2>
                    <p>Your notes on <b>${UI.mainInput.value.split(' ')[0]}</b> have been analyzed using high-fidelity logic extraction.</p>
                    <p><b>Structural Insight:</b> Your material follows a linear timeline, but the AI suggests studying it as a <b>Causal Hierarchy</b>. This will help you understand the "Why" behind the events, rather than just the "When."</p>
                `;
            }

            UI.resultTarget.innerHTML = outputHtml;
            
            // Smooth scroll to results
            setTimeout(() => {
                const scrollPosition = UI.resultSection.offsetTop - 40;
                window.scrollTo({ top: scrollPosition, behavior: 'smooth' });
            }, 150);
        };

        // --- 10.11 MODAL & AUTH TRIGGERS ---
        window.openUpgradeModal = () => {
            UI.modal.style.display = "flex";
            document.body.style.overflow = "hidden";
        };

        window.closeUpgradeModal = () => {
            UI.modal.style.display = "none";
            document.body.style.overflow = "auto";
        };

        window.performSignOut = () => {
            if (confirm("Are you sure you want to end your session?")) {
                signOut(auth);
            }
        };

        window.wipeLocalIdentity = async () => {
            if (confirm("This will permanently delete your custom nickname and local cache. Continue?")) {
                try {
                    const userDoc = doc(db, "users", auth.currentUser.uid);
                    await updateDoc(userDoc, { nickname: "" });
                    location.reload();
                } catch (e) {
                    alert("Error clearing identity.");
                }
            }
        };

    </script>
</body>
</html>
