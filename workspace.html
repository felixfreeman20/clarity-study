<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Workspace</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; margin: 0; overflow-x: hidden; }
        
        /* RESTORED: Aura Backgrounds */
        .aura { position: fixed; width: 800px; height: 800px; border-radius: 50%; filter: blur(120px); z-index: -1; opacity: 0.25; animation: drift 25s infinite alternate ease-in-out; }
        .aura-1 { background: #6366f1; top: -20%; left: -10%; } 
        .aura-2 { background: #a855f7; bottom: -20%; right: -10%; }
        @keyframes drift { 0% { transform: translate(0,0) scale(1); } 100% { transform: translate(150px, 150px) scale(1.2); } }

        /* Sidebar Styling */
        .sidebar { width: 320px; height: 100vh; position: fixed; left: 0; top: 0; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(30px); border-right: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column; z-index: 50; }
        
        /* Main Workspace Area */
        .workspace-container { flex: 1; margin-left: 320px; padding: 60px 100px; position: relative; z-index: 10; }
        
        /* Mode Cards */
        .mode-card { background: #fff; border: 1px solid #000; padding: 28px 10px; border-radius: 24px; text-align: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0px #000; }
        .mode-card.active { background: #000 !important; color: #fff !important; box-shadow: none; transform: translateY(4px); }
        
        /* Glass Input */
        .glass-input { width: 100%; height: 250px; border-radius: 28px; border: 1px solid rgba(0,0,0,0.08); background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 30px; outline: none; font-size: 1.1rem; line-height: 1.6; transition: border 0.3s; }
        .glass-input:focus { border: 1px solid #000; }

        .prose h1, .prose h2, .prose h3 { font-weight: 800; tracking: -0.025em; }
    </style>
</head>
<body>
    <div class="aura aura-1"></div>
    <div class="aura aura-2"></div>

    <aside class="sidebar">
        <div class="p-8">
            <img src="Clarity Logo.png" alt="Clarity" class="h-12 w-auto">
        </div>
        <nav class="px-6 flex-1">
            <a href="dashboard.html" class="flex items-center gap-4 p-4 rounded-2xl text-slate-500 hover:bg-white/50 transition mb-2"><span>üè†</span> Dashboard</a>
            <a href="workspace.html" class="flex items-center gap-4 p-4 rounded-2xl bg-black text-white mb-2 shadow-lg"><span>‚ú¶</span> Workspace</a>
            <a href="saved.html" class="flex items-center gap-4 p-4 rounded-2xl text-slate-500 hover:bg-white/50 transition"><span>üìÅ</span> Archive</a>
        </nav>
        
        <div id="pro-nudge" class="px-6 mb-4 hidden">
            <a href="pricing.html" class="block w-full text-center bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg hover:scale-105 transition">‚ú® Go Pro</a>
        </div>

        <div class="p-8 border-t bg-white/30">
            <p id="user-display" class="font-bold mb-1 text-sm">Loading...</p>
            <button id="logoutBtn" class="text-[10px] text-red-500 font-black uppercase tracking-widest">Sign Out</button>
        </div>
    </aside>

    <main class="workspace-container">
        <div class="max-w-[800px] mx-auto">
            <header class="mb-16 text-center">
                <h2 class="text-7xl font-black tracking-tighter">Clarity.</h2>
                <p class="text-slate-400 font-medium mt-2">What are we mastering today?</p>
            </header>

            <div class="grid grid-cols-4 gap-4 mb-8">
                <div class="mode-card active" onclick="setMode('summary', this)">
                    <span class="text-xl">üìñ</span>
                    <p class="text-[10px] font-bold mt-1 uppercase">Deep Dive</p>
                </div>
                <div class="mode-card" onclick="setMode('speed', this)">
                    <span class="text-xl">‚ö°</span>
                    <p class="text-[10px] font-bold mt-1 uppercase">Speed</p>
                </div>
                <div class="mode-card" onclick="setMode('quiz', this)">
                    <span class="text-xl">üß†</span>
                    <p class="text-[10px] font-bold mt-1 uppercase">Quiz</p>
                </div>
                <div class="mode-card" onclick="setMode('flash', this)">
                    <span class="text-xl">üìá</span>
                    <p class="text-[10px] font-bold mt-1 uppercase">Flashcards</p>
                </div>
            </div>

            <div id="quizSliderContainer" class="hidden mb-6 bg-white/80 backdrop-blur p-6 rounded-3xl border-2 border-black">
                <div class="flex justify-between mb-2">
                    <span class="text-xs font-bold uppercase">Number of Questions</span> 
                    <span id="qVal" class="text-xs font-bold">1</span>
                </div>
                <input type="range" id="qSlider" min="1" max="30" value="1" class="w-full accent-black" oninput="updateSlider(this.value)">
            </div>

            <div class="relative">
                <textarea id="studyInput" class="glass-input" placeholder="Paste your lecture notes, textbook chapters, or raw data here..."></textarea>
                <div class="absolute bottom-6 right-6 flex gap-2">
                    <button class="bg-slate-100 hover:bg-slate-200 p-3 rounded-xl transition">üìé</button>
                </div>
            </div>

            <button id="generateBtn" class="w-full bg-black text-white py-6 rounded-[30px] font-bold mt-6 text-lg hover:shadow-2xl transition-all active:scale-[0.98]">
                Start AI Session
            </button>

            <div id="outputArea" class="mt-10 p-10 bg-white rounded-[40px] hidden border-2 border-black shadow-xl">
                <div id="aiResult" class="prose max-w-none prose-slate prose-p:leading-relaxed prose-headings:font-black">
                    </div>
                <div class="mt-8 pt-8 border-t flex justify-end gap-4">
                    <button class="text-sm font-bold opacity-40 hover:opacity-100">Copy text</button>
                    <button class="bg-black text-white px-6 py-2 rounded-full text-sm font-bold">Save to Archive</button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentMode = 'summary';
        let isPremium = false;

        // AUTH GUARD: Ensure user is logged in
        onAuthStateChanged(auth, async (u) => {
            if (u) {
                const s = await getDoc(doc(db, "users", u.uid));
                if (s.exists()) {
                    document.getElementById('user-display').innerText = s.data().nickname;
                    isPremium = s.data().isPremium || false;
                    if(!isPremium) document.getElementById('pro-nudge').classList.remove('hidden');
                } else {
                    window.location.href = "pricing.html";
                }
            } else {
                window.location.href = "index.html";
            }
        });

        document.getElementById('logoutBtn').onclick = () => signOut(auth);

        // UI LOGIC
        window.setMode = (m, el) => {
            currentMode = m;
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            
            const slider = document.getElementById('quizSliderContainer');
            slider.classList.toggle('hidden', m !== 'quiz');
        };

        window.updateSlider = (v) => {
            const qVal = document.getElementById('qVal');
            const qSlider = document.getElementById('qSlider');
            if (!isPremium && v > 1) {
                qSlider.value = 1;
                qVal.innerText = "1 (Pro Required)";
            } else {
                qVal.innerText = v;
            }
        };

        // GENERATION PLACEHOLDER
        document.getElementById('generateBtn').onclick = () => {
            const input = document.getElementById('studyInput').value;
            if(!input) return alert("Please enter some notes first!");
            
            const output = document.getElementById('outputArea');
            const result = document.getElementById('aiResult');
            
            output.classList.remove('hidden');
            result.innerHTML = `<em>Generating your ${currentMode}...</em>`;
            
            // This is where your actual OpenAI/Gemini fetch logic goes
            setTimeout(() => {
                result.innerHTML = marked.parse(`### Your ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} is ready.\n\nThis is a sample layout of the generated content. You can now save this to your archive.`);
            }, 1500);
        };
    </script>
</body>
</html>
