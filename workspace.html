<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Professional Studio</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================================
           1. ARCHITECTURE & DESIGN TOKENS
        ========================================================= */
        :root {
            --c-canvas: #ffffff;
            --c-ink: #000000;
            --c-border: #000000;
            --c-surface-light: #f4f4f5;
            --c-surface-dark: #18181b;
            --sidebar-w: 280px;
            --transition-main: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* =========================================================
           2. GLOBAL RESET
        ========================================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            background-color: var(--c-canvas);
            color: var(--c-ink);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        button {
            cursor: pointer;
            transition: var(--transition-main);
        }

        /* =========================================================
           3. SIDEBAR NAVIGATION SYSTEM
        ========================================================= */
        .app-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-w);
            border-right: 1px solid #eeeeee;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            z-index: 1000;
        }

        .brand-lockup {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 60px;
        }

        .brand-square {
            width: 22px;
            height: 22px;
            background-color: #000000;
            border-radius: 4px;
        }

        .brand-text {
            font-weight: 900;
            font-size: 22px;
            letter-spacing: -0.05em;
            text-transform: uppercase;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 0;
            color: #71717a;
            font-weight: 800;
            font-size: 14px;
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-link:hover, .nav-link.active {
            color: #000000;
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 30px;
            border-top: 1px solid #f4f4f5;
        }

        .user-pill {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .avatar-box {
            width: 42px;
            height: 42px;
            background: #000000;
            color: #ffffff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
        }

        .logout-btn {
            font-size: 10px;
            font-weight: 900;
            color: #a1a1aa;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 4px;
        }

        /* =========================================================
           4. MAIN CONTENT LAYOUT
        ========================================================= */
        .view-container {
            margin-left: var(--sidebar-w);
            padding: 80px 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .view-section {
            width: 100%;
            max-width: 1000px;
            display: none;
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .view-section.active {
            display: block;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* =========================================================
           5. THE STUDIO CANVAS (BRUTALIST REFINED)
        ========================================================= */
        .studio-frame {
            border: 2px solid var(--c-border);
            border-radius: 40px;
            background: #ffffff;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
            transition: var(--transition-main);
        }

        .studio-frame:focus-within {
            box-shadow: 0 40px 80px rgba(0,0,0,0.08);
            transform: translateY(-4px);
        }

        /* Minimal PDF Dropzone */
        .sync-zone {
            padding: 22px;
            background: #fafafa;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #52525b;
        }

        .sync-zone:hover {
            background: #000000;
            color: #ffffff;
        }

        /* Mode Selector Toolbar */
        .studio-toolbar {
            padding: 20px 40px;
            border-bottom: 1px solid #f4f4f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mode-switcher {
            display: flex;
            background: #f4f4f5;
            padding: 6px;
            border-radius: 20px;
            gap: 4px;
        }

        .mode-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 24px;
            border-radius: 14px;
            font-weight: 800;
            font-size: 12px;
            text-transform: uppercase;
            color: #71717a;
        }

        .mode-btn svg {
            width: 16px;
            height: 16px;
            stroke-width: 2.5px;
        }

        .mode-btn.active {
            background-color: #000000;
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* The Input Canvas */
        #studio-input {
            width: 100%;
            min-height: 500px;
            padding: 60px 80px;
            font-size: 24px;
            line-height: 1.6;
            font-weight: 500;
            color: #000000;
            border: none;
            outline: none;
            resize: none;
            text-align: left;
        }

        #studio-input::placeholder {
            color: #d4d4d8;
        }

        /* =========================================================
           6. ACTION SYSTEMS
        ========================================================= */
        .generate-trigger-area {
            margin-top: -38px;
            position: relative;
            z-index: 10;
        }

        .btn-primary-action {
            background: #000000;
            color: #ffffff;
            padding: 26px 70px;
            border-radius: 100px;
            font-weight: 900;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            display: flex;
            align-items: center;
            gap: 14px;
            border: 5px solid #ffffff;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .btn-primary-action:hover {
            transform: scale(1.04);
            box-shadow: 0 30px 60px rgba(0,0,0,0.25);
        }

        /* =========================================================
           7. AI RESULT RENDERING
        ========================================================= */
        .result-container {
            width: 100%;
            max-width: 820px;
            margin-top: 100px;
            display: none;
        }

        .result-hr {
            height: 1px;
            background: #000000;
            width: 100%;
            margin-bottom: 60px;
        }

        .result-content h2 {
            font-weight: 900;
            font-size: 56px;
            letter-spacing: -0.05em;
            line-height: 1;
            margin-bottom: 40px;
            text-transform: uppercase;
        }

        .result-content p {
            font-size: 22px;
            line-height: 1.7;
            color: #18181b;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .result-content b {
            font-weight: 900;
            color: #000000;
        }

        /* =========================================================
           8. PRO PAGE & UPSELL MODAL
        ========================================================= */
        .pro-card {
            background: #f4f4f5;
            border-radius: 40px;
            padding: 60px;
            text-align: center;
            margin-top: 40px;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-box {
            background: #ffffff;
            width: 100%;
            max-width: 460px;
            border: 3px solid #000000;
            border-radius: 40px;
            padding: 60px 50px;
            text-align: center;
            position: relative;
        }

    </style>
</head>
<body>

    <div id="modal-upsell" class="modal-overlay">
        <div class="modal-box">
            <button onclick="closeModal()" class="absolute top-8 left-8 text-3xl font-black">&times;</button>
            <div class="w-16 h-16 bg-black rounded-2xl mx-auto mb-8 flex items-center justify-center">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </div>
            <h3 class="text-3xl font-black mb-4 uppercase tracking-tighter">Pro Required</h3>
            <p class="text-gray-500 font-semibold mb-10">Exam Mode and 3,000 word contexts are exclusive to Clarity Pro members.</p>
            <div class="bg-gray-100 rounded-3xl p-8 mb-8">
                <span class="text-5xl font-black">$4.99</span> <span class="text-gray-400 font-bold uppercase text-sm">/ month</span>
            </div>
            <button class="w-full bg-black text-white py-6 rounded-full font-black uppercase tracking-widest text-sm hover:scale-105 transition-all">Unlock Engine</button>
        </div>
    </div>

    <aside class="app-sidebar">
        <div class="brand-lockup">
            <div class="brand-square"></div>
            <h1 class="brand-text">CLARITY</h1>
        </div>

        <nav class="flex flex-col gap-2">
            <button onclick="switchView('studio')" id="nav-studio" class="nav-link active">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 6h16M4 12h16M4 18h7"/></svg>
                STUDIO
            </button>
            <button onclick="switchView('pro')" id="nav-pro" class="nav-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                PRO FEATURES
            </button>
            <button onclick="switchView('settings')" id="nav-settings" class="nav-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                SETTINGS
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="user-pill">
                <div id="user-avatar" class="avatar-box">?</div>
                <div>
                    <p id="display-name" class="font-black text-xs uppercase tracking-tight text-black">Student</p>
                    <button onclick="handleSignOut()" class="logout-btn">Sign Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="view-container">

        <section id="view-studio" class="view-section active">
            <div class="studio-frame">
                <div class="sync-zone" onclick="document.getElementById('file-pdf').click()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3.5"><path d="M12 5v14M5 12h14"/></svg>
                    <span>Drop PDF to sync context</span>
                    <input type="file" id="file-pdf" class="hidden" accept=".pdf">
                </div>

                <div class="studio-toolbar">
                    <div class="mode-switcher">
                        <button class="mode-btn active" onclick="setMode('deep', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 21a9 9 0 100-18 9 9 0 000 18zM12 8v4m0 4h.01"/></svg>
                            Deep
                        </button>
                        <button class="mode-btn" onclick="setMode('speed', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                            Speed
                        </button>
                        <button class="mode-btn" onclick="setMode('quiz', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 11l3 3L22 4m-2 12a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                            Quiz
                        </button>
                        <button class="mode-btn" onclick="setMode('exam', this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Exam
                        </button>
                    </div>
                    <div id="word-count-label" class="text-[10px] font-black text-gray-300 uppercase tracking-widest">0 / 1000</div>
                </div>

                <textarea id="studio-input" placeholder="Paste your lecture notes, essay draft, or research here to begin synthesis..."></textarea>
            </div>

            <div class="generate-trigger-area">
                <button id="btn-generate-insight" class="btn-primary-action">
                    GENERATE INSIGHT
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </button>
            </div>

            <div id="result-display" class="result-container">
                <div class="result-hr"></div>
                <div id="result-target" class="result-content">
                    </div>
            </div>
        </section>

        <section id="view-pro" class="view-section">
            <h2 class="text-5xl font-black tracking-tighter uppercase mb-8">Clarity Pro</h2>
            <div class="grid grid-cols-2 gap-6 mb-12">
                <div class="border-2 border-black p-10 rounded-3xl">
                    <h4 class="font-black text-xl mb-4 uppercase">Extended Context</h4>
                    <p class="text-gray-600 font-medium">Process up to 3,000 words in a single synthesis. Ideal for full research papers.</p>
                </div>
                <div class="bg-black text-white p-10 rounded-3xl">
                    <h4 class="font-black text-xl mb-4 uppercase">Exam Mode</h4>
                    <p class="text-gray-400 font-medium">Timed simulations that grade your logic based on the specific material provided.</p>
                </div>
            </div>
            <div class="pro-card">
                <p class="text-sm font-black text-gray-400 uppercase tracking-widest mb-4">Academic Subscription</p>
                <h3 class="text-6xl font-black mb-8">$4.99/mo</h3>
                <button class="bg-black text-white px-12 py-5 rounded-full font-black uppercase tracking-widest">Upgrade Now</button>
            </div>
        </section>

        <section id="view-settings" class="view-section">
            <h2 class="text-4xl font-black tracking-tighter uppercase mb-12">Settings</h2>
            <div class="border border-gray-100 p-8 rounded-3xl mb-6">
                <h4 class="font-black text-sm uppercase text-gray-400 mb-6">Account & Identity</h4>
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-bold text-lg">Clear Local Identity</p>
                        <p class="text-gray-500 text-sm">Remove your nickname and local caching.</p>
                    </div>
                    <button onclick="clearCache()" class="text-red-500 font-black text-xs uppercase tracking-widest border border-red-100 px-6 py-3 rounded-xl hover:bg-red-50">Wipe Cache</button>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        // 1. FIREBASE INTEGRATION
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 2. INITIALIZATION
        const firebaseConfig = { 
            apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", 
            authDomain: "clarity-study-cd835.firebaseapp.com", 
            projectId: "clarity-study-cd835", 
            storageBucket: "clarity-study-cd835.firebasestorage.app", 
            messagingSenderId: "92484724607", 
            appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" 
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 3. STATE REPOSITORY
        let USER_PROFILE = null;
        let ACTIVE_MODE = 'deep';
        const DOM = {
            input: document.getElementById('studio-input'),
            wordCount: document.getElementById('word-count-label'),
            results: document.getElementById('result-display'),
            target: document.getElementById('result-target'),
            avatar: document.getElementById('user-avatar'),
            name: document.getElementById('display-name'),
            modal: document.getElementById('modal-upsell')
        };

        // 4. AUTHENTICATION FLOW
        onAuthStateChanged(auth, async (user) => {
            console.log("Clarity Session Check...");
            if (!user) {
                window.location.href = "index.html";
                return;
            }

            try {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    USER_PROFILE = userDoc.data();
                    DOM.name.innerText = (USER_PROFILE.nickname || "STUDENT").toUpperCase();
                    DOM.avatar.innerText = (USER_PROFILE.nickname || "S").charAt(0).toUpperCase();
                }
            } catch (err) {
                console.error("Auth Fetch Error:", err);
            }
        });

        // 5. WORD COUNT LOGIC
        DOM.input.addEventListener('input', () => {
            const words = DOM.input.value.trim() ? DOM.input.value.trim().split(/\s+/).length : 0;
            const limit = USER_PROFILE?.isPro ? 3000 : 1000;
            
            DOM.wordCount.innerText = `${words} / ${limit}`;
            
            if (words > limit) {
                DOM.wordCount.style.color = "#ef4444";
                const truncated = DOM.input.value.split(/\s+/).slice(0, limit).join(" ");
                DOM.input.value = truncated;
            } else {
                DOM.wordCount.style.color = "#d1d5db";
            }
        });

        // 6. VIEW NAVIGATION ENGINE
        window.switchView = (viewId) => {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(`nav-${viewId}`).classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // 7. STUDIO MODE ENGINE
        window.setMode = (modeId, element) => {
            if (modeId === 'exam' && !USER_PROFILE?.isPro) {
                window.openModal();
                return;
            }

            ACTIVE_MODE = modeId;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            element.classList.add('active');
        };

        // 8. SYNTHESIS GENERATOR
        document.getElementById('btn-generate-insight').onclick = () => {
            const rawContent = DOM.input.value.toLowerCase().trim();
            if (!rawContent) return;

            DOM.results.style.display = "block";
            let outputHtml = "";

            // LOGIC BRANCH: American Civil War Context
            if (rawContent.includes("civil war") || rawContent.includes("american civil")) {
                outputHtml = `
                    <h2>The Logic of Conflict</h2>
                    <p>Analysis of your notes suggests a primary theme of <b>Industrial Attrition</b>. While the specific battles you mentioned are tactical milestones, the synthesis engine identifies the <i>Railroad Logistics gap</i> as the mathematical tipping point.</p>
                    <p><b>Critical Connection:</b> Your mention of the Anaconda Plan aligns with the economic strangulation logic. Study the intersection of Southern cotton prices and British neutralityâ€”this is a high-probability exam topic.</p>
                `;
            } else {
                outputHtml = `
                    <h2>Synthesis Complete</h2>
                    <p>Your material regarding <b>${DOM.input.value.split(' ')[0]}</b> has been processed through the logical engine.</p>
                    <p><b>Structural Insight:</b> The input follows a linear chronological pattern. To master this content, the AI suggests re-organizing these facts into a <i>Causal Chain</i> (Cause -> Action -> Reaction) for 40% better retention.</p>
                `;
            }

            DOM.target.innerHTML = outputHtml;
            setTimeout(() => {
                window.scrollTo({ top: DOM.results.offsetTop - 40, behavior: 'smooth' });
            }, 100);
        };

        // 9. MODAL & UTILITY FUNCTIONS
        window.openModal = () => DOM.modal.style.display = "flex";
        window.closeModal = () => DOM.modal.style.display = "none";
        
        window.handleSignOut = () => {
            if (confirm("End your Clarity session?")) signOut(auth);
        };

        window.clearCache = async () => {
            if (confirm("Permanently wipe identity data?")) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" });
                location.reload();
            }
        };

        // PDF Drag/Drop Interaction
        const dropzone = document.querySelector('.sync-zone');
        dropzone.ondragover = (e) => { e.preventDefault(); dropzone.style.background = "#000"; dropzone.style.color = "#fff"; };
        dropzone.ondragleave = () => { dropzone.style.background = "#fafafa"; dropzone.style.color = "#52525b"; };
        dropzone.ondrop = (e) => {
            e.preventDefault();
            const fileName = e.dataTransfer.files[0].name;
            dropzone.innerHTML = `<span>CONTEXT SYNCED: ${fileName}</span>`;
            dropzone.style.background = "#000";
            dropzone.style.color = "#fff";
        };

    </script>
</body>
</html>
