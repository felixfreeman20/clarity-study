<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace | Clarity</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #4f46e5; --bg: #f8fafc; --panel: #ffffff; --text: #0f172a; --border: #e2e8f0; }
        .dark-theme { --bg: #0f172a; --panel: #1e293b; --text: #f8fafc; --border: #334155; }
        
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: background 0.3s ease; }
        .sidebar { width: 280px; background: var(--panel); border-right: 1px solid var(--border); height: 100vh; position: fixed; display: flex; flex-direction: column; }
        .main-content { margin-left: 280px; padding: 60px; min-height: 100vh; }
        
        .nav-btn { padding: 12px 16px; border-radius: 10px; display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 600; transition: 0.2s; color: #64748b; }
        .nav-btn:hover { background: rgba(79, 70, 229, 0.05); color: var(--accent); }
        .nav-btn.active { background: var(--accent); color: white !important; }

        .studio-box { background: var(--panel); border: 1px solid var(--border); border-radius: 24px; display: flex; flex-direction: column; height: 65vh; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        .mode-tab { padding: 10px 20px; border-radius: 12px; font-weight: 700; font-size: 13px; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; background: var(--panel); }
        .mode-tab.active { border-color: var(--accent); color: var(--accent); background: rgba(79, 70, 229, 0.08); }
        
        .onboarding-overlay { position: fixed; inset: 0; z-index: 9999; background: white; display: flex; items: center; justify-content: center; }
        .pro-badge { background: linear-gradient(45deg, #4f46e5, #9333ea); color: white; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        
        /* Quiz Specifics */
        .quiz-config { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border); }
        .limit-btn { padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border); font-size: 12px; font-weight: 600; }
        .limit-btn.locked { opacity: 0.5; cursor: not-allowed; background: #f1f5f9; position: relative; }
        
        textarea { background: transparent; color: inherit; resize: none; border: none; outline: none; width: 100%; height: 100%; padding: 40px; font-size: 18px; line-height: 1.6; }
    </style>
</head>
<body>

    <div id="onboarding" class="hidden onboarding-overlay">
        <div class="max-w-md w-full p-8 text-center">
            <h2 class="text-4xl font-black mb-2">Clarity.</h2>
            <p class="text-gray-400 mb-10 font-medium">What is your name?</p>
            <input type="text" id="nickInput" class="w-full text-center text-3xl font-bold border-b-4 border-gray-100 focus:border-indigo-600 outline-none pb-3 mb-10" placeholder="Type here...">
            <button id="saveNickBtn" class="w-full bg-black text-white py-4 rounded-2xl font-bold hover:scale-[1.02] transition-transform">Enter Workspace</button>
        </div>
    </div>

    <aside class="sidebar p-6">
        <div class="flex items-center gap-2 mb-12">
            <img src="Clarity Logo.png" class="h-8">
            <span class="font-bold text-xl tracking-tight">Clarity</span>
        </div>

        <nav class="flex-1 space-y-2">
            <div onclick="switchView('studio')" id="tab-studio" class="nav-btn active">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                AI Studio
            </div>
            <div onclick="switchView('pro')" id="tab-pro" class="nav-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-7.714 2.143L11 21l-2.286-6.857L1 12l7.714-2.143L11 3z"/></svg>
                Pro Features
            </div>
            <div onclick="switchView('settings')" id="tab-settings" class="nav-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                Settings
            </div>
        </nav>

        <div class="mt-auto border-t border-gray-100 pt-6">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold" id="userInitial">?</div>
                <div class="overflow-hidden">
                    <p id="profileName" class="font-bold text-sm truncate">Student</p>
                    <button onclick="logout()" class="text-xs text-gray-400 hover:text-red-500 font-medium">Log Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        
        <div id="view-studio" class="max-w-5xl">
            <header class="mb-10">
                <h1 class="text-4xl font-black tracking-tight">AI Studio.</h1>
                <p class="text-gray-500 font-medium mt-1">Hello, <span id="helloName">...</span>. What are we learning today?</p>
            </header>

            <div class="studio-box">
                <textarea id="aiInput" placeholder="Paste your study material, notes, or raw text here..."></textarea>
                
                <div class="p-6 bg-gray-50 rounded-b-2xl border-t border-gray-100">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex gap-2">
                            <button class="mode-tab active" onclick="setMode('deep', this)">Deep Dive</button>
                            <button class="mode-tab" onclick="setMode('speed', this)">Speed</button>
                            <button class="mode-btn mode-tab" onclick="setMode('flashcards', this)">Flashcards</button>
                            <button class="mode-tab" onclick="setMode('quiz', this)">Quiz</button>
                        </div>

                        <button id="genBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg active:scale-95 flex items-center gap-2">
                            Generate <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1a1 1 0 112 0v1a1 1 0 11-2 0zM13.536 14.95a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zM15 10a5 5 0 11-10 0 5 5 0 0110 0z"/></svg>
                        </button>
                    </div>

                    <div id="quizConfig" class="quiz-config">
                        <p class="text-[11px] font-black text-gray-400 uppercase tracking-widest mb-3">Questions Count</p>
                        <div class="flex gap-2">
                            <button class="limit-btn bg-white" onclick="setLimit(5, this)">5 Qs</button>
                            <button class="limit-btn bg-white" onclick="setLimit(10, this)">10 Qs</button>
                            <button class="limit-btn locked" onclick="checkPro()">20 Qs <span class="pro-badge">Pro</span></button>
                            <button class="limit-btn locked" onclick="checkPro()">50 Qs <span class="pro-badge">Pro</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-pro" class="hidden max-w-4xl">
            <h1 class="text-4xl font-black mb-6 tracking-tight">Pro Access.</h1>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-8 rounded-3xl border border-gray-100 shadow-sm">
                    <div class="h-12 w-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mb-6"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg></div>
                    <h3 class="text-xl font-bold mb-2">Extended Quizzes</h3>
                    <p class="text-gray-500 text-sm">Generate up to 50 questions at once for massive exam preparation.</p>
                </div>
                <div class="bg-white p-8 rounded-3xl border border-gray-100 shadow-sm">
                    <div class="h-12 w-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center mb-6"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg></div>
                    <h3 class="text-xl font-bold mb-2">Ultra-Fast Model</h3>
                    <p class="text-gray-500 text-sm">Use the specialized Clarity Speed model for near-instant responses.</p>
                </div>
            </div>
            <button class="mt-8 bg-black text-white px-10 py-4 rounded-2xl font-bold">Upgrade to Pro</button>
        </div>

        <div id="view-settings" class="hidden max-w-2xl">
            <h1 class="text-4xl font-black mb-8 tracking-tight">Settings.</h1>
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-2xl border border-gray-100 flex items-center justify-between">
                    <div>
                        <p class="font-bold">Dark Mode</p>
                        <p class="text-gray-500 text-xs">Switch to a darker interface.</p>
                    </div>
                    <button onclick="toggleTheme()" class="bg-gray-100 p-2 rounded-lg"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg></button>
                </div>
                <div class="bg-white p-6 rounded-2xl border border-gray-100">
                    <p class="font-bold mb-4">Reset Name</p>
                    <button onclick="resetName()" class="text-red-500 font-bold text-sm">Change Nickname</button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserData = null;
        let selectedMode = 'deep';
        let questionLimit = 5;

        // AUTH & ONBOARDING ROUTING
        onAuthStateChanged(auth, async (u) => {
            if(!u) return window.location.href="index.html";
            const snap = await getDoc(doc(db, "users", u.uid));
            if(snap.exists()){
                currentUserData = snap.data();
                if(currentUserData.isVerified === false) return window.location.href="verify.html";
                
                if(!currentUserData.nickname) {
                    document.getElementById('onboarding').classList.remove('hidden');
                } else {
                    updateProfileUI(currentUserData.nickname);
                }
            }
        });

        function updateProfileUI(name) {
            document.getElementById('profileName').innerText = name;
            document.getElementById('helloName').innerText = name;
            document.getElementById('userInitial').innerText = name.charAt(0).toUpperCase();
            document.getElementById('onboarding').classList.add('hidden');
        }

        // MODE SELECTION LOGIC
        window.setMode = (mode, btn) => {
            selectedMode = mode;
            document.querySelectorAll('.mode-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // Show quiz config only for quiz mode
            document.getElementById('quizConfig').style.display = (mode === 'quiz') ? 'block' : 'none';
        };

        window.setLimit = (num, btn) => {
            questionLimit = num;
            document.querySelectorAll('.limit-btn').forEach(b => b.classList.remove('bg-indigo-600', 'text-white'));
            btn.classList.add('bg-indigo-600', 'text-white');
        };

        window.checkPro = () => {
            alert("Upgrade to Pro to unlock higher question limits!");
            switchView('pro');
        };

        // VIEW SWITCHER
        window.switchView = (v) => {
            ['studio', 'pro', 'settings'].forEach(view => {
                document.getElementById(`view-${view}`).classList.toggle('hidden', view !== v);
                document.getElementById(`tab-${view}`).classList.toggle('active', view === v);
            });
        };

        // SETTINGS LOGIC
        window.toggleTheme = () => {
            document.body.classList.toggle('dark-theme');
        };

        window.resetName = async () => {
            await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" });
            location.reload();
        };

        document.getElementById('saveNickBtn').onclick = async () => {
            const val = document.getElementById('nickInput').value.trim();
            if(!val) return alert("Enter a name");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: val });
            updateProfileUI(val);
        };

        window.logout = () => signOut(auth);

        // GENERATE BUTTON
        document.getElementById('genBtn').onclick = () => {
            const text = document.getElementById('aiInput').value;
            if(!text) return alert("Paste some notes first!");
            alert(`Generating ${selectedMode} with ${questionLimit} limit...`);
        };
    </script>
</body>
</html>
