<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Professional Studio</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #ffffff; 
            --canvas: #fcfcfc;
            --panel: #ffffff; 
            --text: #0a0a0a; 
            --border: #ececec; 
            --subtext: #8e8e93; 
            --accent: #4f46e5; 
            --accent-soft: rgba(79, 70, 229, 0.05);
        }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh; 
        }

        /* SIDEBAR NAVIGATION */
        .sidebar { 
            width: 280px; 
            border-right: 1px solid var(--border); 
            height: 100vh; 
            position: fixed; 
            display: flex; 
            flex-direction: column; 
            z-index: 100; 
            padding: 50px 40px;
            background: var(--bg);
        }

        .nav-link {
            width: 100%;
            text-align: left;
            padding: 12px 0;
            font-weight: 700;
            font-size: 15px;
            color: var(--subtext);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav-link.active { color: var(--accent); }
        .nav-link:hover:not(.active) { color: var(--text); }

        /* MAIN CONTENT & CANVAS AREA */
        .main-content { 
            margin-left: 280px; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 60px; 
            position: relative;
        }
        
        .studio-frame { 
            width: 100%; 
            max-width: 1000px; 
            height: 85vh; 
            display: flex; 
            flex-direction: column; 
            position: relative;
        }

        /* CENTERED TEXT ENGINE */
        .editor-surface {
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            background: var(--canvas);
            border-radius: 48px; 
            border: 1px solid var(--border); 
            overflow: hidden; 
            position: relative;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        textarea { 
            width: 100%; 
            height: 100%; 
            padding: 120px 80px; 
            font-size: 26px; 
            line-height: 1.6; 
            border: none; 
            outline: none; 
            background: transparent;
            resize: none; 
            text-align: center; 
            font-weight: 500;
            color: var(--text);
        }
        textarea::placeholder { color: #d1d1d6; }

        /* INTEGRATED RESPONSE PANEL */
        #responsePanel {
            position: absolute; 
            inset: 15px;
            background: rgba(255, 255, 255, 0.98); 
            backdrop-filter: blur(30px);
            border-radius: 40px; 
            border: 1px solid var(--border); 
            z-index: 200;
            display: none; 
            flex-direction: column; 
            padding: 60px; 
            box-shadow: 0 40px 80px rgba(0,0,0,0.08);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #responsePanel.show { display: flex; transform: translateY(0); opacity: 1; }

        /* UI ELEMENTS */
        .top-shelf { 
            position: absolute; 
            top: 40px; 
            left: 0; 
            right: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            gap: 20px; 
            z-index: 90; 
        }

        .util-btn {
            background: white;
            border: 1px solid var(--border);
            padding: 8px 18px;
            border-radius: 14px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: 0.2s;
        }
        .util-btn:hover { background: #fafafa; border-color: #d1d1d6; }

        .bottom-bar { 
            padding: 30px 45px; 
            border-top: 1px solid var(--border); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: white;
        }
        
        .mode-group { display: flex; gap: 4px; background: #f5f5f7; padding: 4px; border-radius: 16px; }
        .mode-btn { 
            padding: 10px 18px; 
            border-radius: 12px; 
            font-weight: 700; 
            font-size: 12px; 
            color: var(--subtext); 
            transition: 0.2s; 
        }
        .mode-btn.active { 
            background: white; 
            color: var(--accent); 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .generate-trigger { 
            background: var(--accent); 
            color: white; 
            padding: 18px 45px; 
            border-radius: 22px; 
            font-weight: 900; 
            font-size: 14px; 
            letter-spacing: 0.02em;
            transition: 0.3s; 
        }
        .generate-trigger:hover { transform: scale(1.02); box-shadow: 0 15px 30px rgba(79, 70, 229, 0.2); }

        .pro-badge { 
            background: #000; 
            color: #fff; 
            padding: 2px 6px; 
            border-radius: 6px; 
            font-size: 8px; 
            margin-left: 6px; 
            font-weight: 900;
        }

        /* SLIDER COMPONENT */
        .slider-wrap { display: flex; items-center; gap: 15px; border-left: 1px solid var(--border); padding-left: 25px; }
        .slider { 
            -webkit-appearance: none; 
            width: 120px; 
            height: 4px; 
            background: #e5e5ea; 
            border-radius: 10px; 
            outline: none;
        }
        .slider::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 20px; 
            height: 20px; 
            background: var(--accent); 
            border-radius: 50%; 
            cursor: pointer; 
            border: 4px solid white; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
        }

        /* VIEWS */
        .view-section { width: 100%; max-width: 1000px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ONBOARDING */
        .onboard-overlay { 
            position: fixed; 
            inset: 0; 
            background: white; 
            z-index: 2000; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } }
    </style>
</head>
<body>

    <div id="onboarding" class="onboard-overlay hidden">
        <div class="text-center w-full max-w-sm px-6">
            <h1 class="text-6xl font-black mb-4 tracking-tighter">Clarity.</h1>
            <p class="text-gray-400 font-medium mb-12">Who are we studying with today?</p>
            <input type="text" id="nickInput" class="w-full text-center text-4xl font-bold border-b-2 border-black outline-none pb-4 mb-12 transition-colors focus:border-indigo-600" placeholder="Name">
            <button id="saveNickBtn" class="w-full bg-black text-white py-6 rounded-3xl font-black text-lg shadow-2xl">Start Session</button>
        </div>
    </div>

    <aside class="sidebar">
        <div class="flex items-center gap-3 mb-20">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg"></div>
            <span class="font-black text-2xl tracking-tighter italic">CLARITY.</span>
        </div>
        
        <nav class="flex-1">
            <button onclick="switchView('studio')" id="tab-studio" class="nav-link active">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5L6 9H2v6h4l5 4V5z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15.54 8.46a5 5 0 010 7.07"/></svg>
                Studio
            </button>
            <button onclick="switchView('pro')" id="tab-pro" class="nav-link">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-7.714 2.143L11 21l-2.286-6.857L1 12l7.714-2.143L11 3z"/></svg>
                Pro Access
            </button>
            <button onclick="switchView('settings')" id="tab-settings" class="nav-link">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg>
                Settings
            </button>
        </nav>

        <div class="pt-10 border-t border-gray-100">
            <div class="flex items-center gap-4">
                <div id="userAvatar" class="w-12 h-12 rounded-2xl bg-gray-100 flex items-center justify-center font-black text-indigo-600 text-xl">?</div>
                <div>
                    <p id="profileName" class="font-black text-sm tracking-tight text-gray-900">Student</p>
                    <button onclick="logout()" class="text-[10px] uppercase font-bold text-indigo-500 hover:text-indigo-700">Disconnect</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        
        <div id="view-studio" class="view-section studio-frame">
            <div class="editor-surface">
                
                <div id="responsePanel">
                    <div class="flex justify-between items-center mb-12">
                        <div class="flex items-center gap-3">
                            <span id="resModeBadge" class="px-3 py-1 bg-indigo-50 text-indigo-600 text-[10px] font-black uppercase tracking-widest rounded-lg">Studio Mode</span>
                            <span id="timerDisplay" class="hidden text-red-500 font-black text-xs">00:00</span>
                        </div>
                        <button onclick="closeResponse()" class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>

                    <div id="resLoading" class="flex-1 flex flex-col items-center justify-center">
                        <div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent animate-spin rounded-full mb-6"></div>
                        <p class="font-black text-lg tracking-tight">Clarity is synthesizing<span class="loading-dots"></span></p>
                    </div>

                    <div id="resContent" class="hidden flex-1 overflow-y-auto pr-6 custom-scroll">
                        <h2 id="resTitle" class="text-5xl font-black mb-8 tracking-tighter">Results.</h2>
                        <div id="resBody" class="text-xl leading-relaxed text-gray-500 space-y-8 pb-10">
                            </div>
                    </div>
                    
                    <div id="resFooter" class="hidden pt-8 border-t border-gray-100 flex justify-end gap-4">
                        <button class="util-btn px-8 py-4 bg-gray-50">Copy Result</button>
                        <button class="util-btn px-8 py-4 bg-indigo-600 text-white border-none">Save to Cloud</button>
                    </div>
                </div>

                <div class="top-shelf">
                    <input type="file" id="pdfInput" class="hidden">
                    <label for="pdfInput" class="util-btn">Import PDF</label>
                    <div id="wordCounter" class="util-btn text-gray-400">0 / 1000 Words</div>
                </div>

                <textarea id="aiInput" placeholder="Paste your messy lecture notes here..."></textarea>

                <div class="bottom-bar">
                    <div class="flex items-center gap-8">
                        <div class="mode-group">
                            <button class="mode-btn active" onclick="setMode('deep', this)">Deep Dive</button>
                            <button class="mode-btn" onclick="setMode('speed', this)">Speed</button>
                            <button class="mode-btn" onclick="setMode('quiz', this)">Quiz</button>
                            <button class="mode-btn" onclick="setMode('exam', this)">Exam <span class="pro-badge">PRO</span></button>
                        </div>

                        <div id="quizExtra" class="hidden slider-wrap">
                            <span id="sliderVal" class="font-black text-indigo-600 text-xl w-6">5</span>
                            <input type="range" min="5" max="50" value="5" step="5" class="slider" id="qSlider">
                        </div>
                    </div>

                    <button id="generateBtn" class="generate-trigger">GENERATE</button>
                </div>
            </div>
        </div>

        <div id="view-pro" class="hidden view-section text-center max-w-4xl">
            <h1 class="text-7xl font-black tracking-tighter mb-6">Clarity Pro.</h1>
            <p class="text-gray-400 text-2xl font-medium mb-16">The ultimate toolkit for serious students.</p>
            
            <div class="grid grid-cols-2 gap-8 text-left">
                <div class="p-10 border border-gray-100 rounded-[40px] bg-gray-50/50">
                    <div class="w-12 h-12 bg-indigo-100 rounded-2xl mb-6 flex items-center justify-center text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                    </div>
                    <h4 class="font-black text-2xl mb-3">3,000 Word Inputs</h4>
                    <p class="text-gray-500 leading-relaxed">Process entire textbooks, long transcripts, or research papers in one single pass.</p>
                </div>
                <div class="p-10 border border-gray-100 rounded-[40px] bg-gray-50/50">
                    <div class="w-12 h-12 bg-indigo-100 rounded-2xl mb-6 flex items-center justify-center text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <h4 class="font-black text-2xl mb-3">Simulated Exams</h4>
                    <p class="text-gray-500 leading-relaxed">Timed mock tests that mirror actual exam stress with instant logical grading.</p>
                </div>
                <div class="p-10 border border-indigo-100 rounded-[40px] bg-indigo-600 text-white col-span-2 flex items-center justify-between">
                    <div>
                        <h4 class="font-black text-3xl mb-2">Unlock Total Mastery</h4>
                        <p class="text-indigo-100 text-lg">Join 10,000+ students studying smarter.</p>
                    </div>
                    <button class="bg-white text-indigo-600 px-12 py-5 rounded-2xl font-black text-sm uppercase tracking-widest shadow-xl">Upgrade — $9.99</button>
                </div>
            </div>
        </div>

        <div id="view-settings" class="hidden view-section max-w-2xl">
            <h1 class="text-5xl font-black tracking-tighter mb-12">Settings.</h1>
            <div class="space-y-4">
                <div class="p-8 border border-gray-100 rounded-[30px] flex items-center justify-between">
                    <div>
                        <p class="font-black text-lg">Focus Haptics</p>
                        <p class="text-gray-400 text-sm">Visual feedback for deep writing sessions.</p>
                    </div>
                    <div class="w-12 h-6 bg-indigo-600 rounded-full relative"><div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full"></div></div>
                </div>
                <div class="p-8 border border-gray-100 rounded-[30px] flex items-center justify-between">
                    <div>
                        <p class="font-black text-lg">Export Minimalist</p>
                        <p class="text-gray-400 text-sm">Removes all branding from generated PDFs.</p>
                    </div>
                    <div class="w-12 h-6 bg-gray-200 rounded-full relative"><div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full"></div></div>
                </div>
                <div class="pt-10">
                    <button onclick="resetIdentity()" class="text-xs font-black text-red-500 uppercase tracking-[0.2em] hover:opacity-70 transition-all">Wipe Local Identity & Cache</button>
                </div>
            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", 
            authDomain: "clarity-study-cd835.firebaseapp.com", 
            projectId: "clarity-study-cd835", 
            storageBucket: "clarity-study-cd835.firebasestorage.app", 
            messagingSenderId: "92484724607", 
            appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userProfile = null;
        let currentMode = 'deep';
        let examTimer = null;

        // AUTHENTICATION OBSERVER
        onAuthStateChanged(auth, async (user) => {
            if(!user) return window.location.href="index.html";
            
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);
            
            if(snap.exists()){
                userProfile = snap.data();
                if(!userProfile.nickname) {
                    document.getElementById('onboarding').classList.remove('hidden');
                } else {
                    initializeStudio(userProfile.nickname);
                }
            }
        });

        function initializeStudio(name) {
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('profileName').innerText = name;
            document.getElementById('userAvatar').innerText = name.charAt(0).toUpperCase();
            updateStats();
        }

        // TEXT ENGINE & PDF LOGIC
        const textArea = document.getElementById('aiInput');
        const counter = document.getElementById('wordCounter');

        textArea.oninput = updateStats;

        function updateStats() {
            const words = textArea.value.trim().split(/\s+/).filter(w => w.length > 0).length;
            const limit = userProfile?.isPro ? 3000 : 1000;
            
            if(words > limit) {
                const trimmed = textArea.value.split(/\s+/).slice(0, limit).join(" ");
                textArea.value = trimmed;
            }
            
            counter.innerText = `${words} / ${limit} WORDS`;
            counter.style.color = (words >= limit) ? '#ef4444' : '#8e8e93';
        }

        document.getElementById('pdfInput').onchange = (e) => {
            const file = e.target.files[0];
            if(file) {
                const label = document.querySelector('label[for="pdfInput"]');
                label.innerText = "Extracting...";
                setTimeout(() => {
                    const mockData = `\n[PDF: ${file.name.toUpperCase()}]\nThe Great Depression (1929–1939) was the longest and most severe depression ever experienced by the industrialized Western world. It began after the U.S. stock market crash of October 1929. The GDP fell by 15% globally.`;
                    textArea.value += mockData;
                    label.innerText = "Import PDF";
                    updateStats();
                }, 1500);
            }
        };

        // GENERATION & RESPONSE PANEL LOGIC
        document.getElementById('generateBtn').onclick = () => {
            if(!textArea.value.trim()) return;
            
            const panel = document.getElementById('responsePanel');
            const loading = document.getElementById('resLoading');
            const content = document.getElementById('resContent');
            const footer = document.getElementById('resFooter');
            const timer = document.getElementById('timerDisplay');

            panel.style.display = "flex";
            setTimeout(() => panel.classList.add('show'), 10);
            
            loading.classList.remove('hidden');
            content.classList.add('hidden');
            footer.classList.add('hidden');
            timer.classList.add('hidden');

            // Simulate Engine processing
            setTimeout(() => {
                loading.classList.add('hidden');
                content.classList.remove('hidden');
                footer.classList.remove('hidden');

                const body = document.getElementById('resBody');
                const title = document.getElementById('resTitle');
                document.getElementById('resModeBadge').innerText = currentMode.toUpperCase();

                if(currentMode === 'speed') {
                    title.innerText = "Speed Summary.";
                    body.innerHTML = `<p class="font-bold text-black italic">"The core of your notes focus on the 1929 Market Crash and the subsequent 15% global GDP drop."</p>
                                      <p>Key Takeaway: Economic fragility is often hidden by rapid credit expansion.</p>`;
                } 
                else if(currentMode === 'quiz') {
                    const count = document.getElementById('qSlider').value;
                    title.innerText = `${count} Practice Questions.`;
                    body.innerHTML = `
                        <div class="space-y-6">
                            <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100">
                                <p class="text-xs font-black text-indigo-500 mb-2 uppercase">Question 1</p>
                                <p class="text-black font-bold">What was the global GDP drop percentage?</p>
                            </div>
                            <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100">
                                <p class="text-xs font-black text-indigo-500 mb-2 uppercase">Question 2</p>
                                <p class="text-black font-bold">Which event triggered the crisis in October 1929?</p>
                            </div>
                        </div>`;
                }
                else if(currentMode === 'exam') {
                    title.innerText = "Simulated Exam.";
                    timer.classList.remove('hidden');
                    startExamTimer(15); // 15 minute mock
                    body.innerHTML = `<p>This is a formal assessment based on your uploaded context. Answer the questions logically. You have 15 minutes.</p>
                                      <hr class="border-gray-100 my-8">
                                      <p class="font-bold text-black text-2xl">Section A: Economic Causes</p>
                                      <p>Analyze the relationship between the 1929 crash and the concept of 'Speculative Bubbles'...</p>`;
                }
                else {
                    title.innerText = "Deep Synthesis.";
                    body.innerHTML = `
                        <p>The provided text outlines a systemic collapse. To master this, we must look beyond the date (1929) and focus on the <strong>structural weaknesses</strong> of the banking system at the time.</p>
                        <div class="bg-indigo-600/5 p-8 rounded-[30px] border border-indigo-600/10">
                            <h4 class="text-indigo-600 font-black mb-2">Mastery Insight</h4>
                            <p class="text-gray-600">The Depression wasn't caused by a single day, but by a lack of diversification in the American economy and the overproduction of consumer goods.</p>
                        </div>`;
                }
            }, 2000);
        };

        function startExamTimer(mins) {
            let seconds = mins * 60;
            if(examTimer) clearInterval(examTimer);
            examTimer = setInterval(() => {
                let m = Math.floor(seconds / 60);
                let s = seconds % 60;
                document.getElementById('timerDisplay').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if(seconds <= 0) clearInterval(examTimer);
                seconds--;
            }, 1000);
        }

        // QUIZ SLIDER & PRO LIMITS
        const qSlider = document.getElementById('qSlider');
        qSlider.oninput = function() {
            if(!userProfile?.isPro && this.value > 10) {
                this.value = 10;
                alert("Upgrade to Pro to generate up to 50 questions.");
            }
            document.getElementById('sliderVal').innerText = this.value;
        };

        // NAVIGATION & MODES
        window.switchView = (v) => {
            ['studio', 'pro', 'settings'].forEach(x => {
                document.getElementById(`view-${x}`).classList.toggle('hidden', x !== v);
                document.getElementById(`tab-${x}`).classList.toggle('active', x === v);
            });
        };

        window.setMode = (m, btn) => {
            if(m === 'exam' && !userProfile?.isPro) {
                switchView('pro');
                return;
            }
            currentMode = m;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('quizExtra').classList.toggle('hidden', m !== 'quiz');
        };

        window.closeResponse = () => {
            if(examTimer) clearInterval(examTimer);
            const panel = document.getElementById('responsePanel');
            panel.classList.remove('show');
            setTimeout(() => panel.style.display = "none", 500);
        };

        window.logout = () => signOut(auth);
        
        window.resetIdentity = async () => {
            if(confirm("Wipe all data and identity?")) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: "" });
                location.reload();
            }
        };

        document.getElementById('saveNickBtn').onclick = async () => {
            const val = document.getElementById('nickInput').value.trim();
            if(val) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { nickname: val });
                initializeStudio(val);
            }
        };
    </script>
</body>
</html>
