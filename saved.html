<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clarity | Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #fff; }
        .sidebar { width: 260px; height: 100vh; position: fixed; left: 0; top: 0; border-right: 1px solid #f0f0f0; padding: 40px 24px; }
        .archive-container { margin-left: 260px; padding: 80px; max-width: 1000px; }
        .session-card { background: #fff; border: 1px solid #eee; border-radius: 20px; padding: 30px; margin-bottom: 20px; }
        .badge { font-size: 10px; font-weight: 800; text-transform: uppercase; padding: 4px 10px; border-radius: 8px; background: #f0f0f0; }
    </style>
</head>
<body>
    <aside class="sidebar flex flex-col">
        <nav class="space-y-6 flex-1">
            <a href="index.html" class="block text-gray-400 hover:text-black transition text-lg">‚ú¶ Workspace</a>
            <a href="saved.html" class="block font-bold text-black italic text-lg">üìÅ Archive</a>
        </nav>
        <div class="pt-6 border-t border-gray-100"><p id="user-display" class="font-bold text-lg text-black">Guest</p></div>
    </aside>
    <main class="archive-container">
        <h1 class="text-5xl font-bold mb-10">Archive</h1>
        <div id="archiveList" class="space-y-6"><p class="text-gray-300">Login on Workspace to view history.</p></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                document.getElementById('user-display').innerText = userDoc.exists() ? userDoc.data().nickname : "Alon";
                const q = query(collection(db, "sessions"), where("uid", "==", user.uid), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                const list = document.getElementById('archiveList');
                list.innerHTML = "";
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const card = document.createElement('div');
                    card.className = "session-card";
                    card.innerHTML = `<span class="badge">${data.mode}</span><p class="mt-4 text-gray-700 whitespace-pre-wrap">${data.content}</p>`;
                    list.appendChild(card);
                });
            }
        });
    </script>
</body>
</html>
