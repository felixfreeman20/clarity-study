<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Study Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #1a1a1a; margin: 0; overflow-x: hidden; }
        
        /* Gradient Orbs Background */
        .orb { position: fixed; width: 600px; height: 600px; border-radius: 50%; filter: blur(120px); z-index: -1; opacity: 0.15; pointer-events: none; }
        .orb-1 { top: -100px; right: -100px; background: #4f46e5; }
        .orb-2 { bottom: -100px; left: -100px; background: #ec4899; }

        /* Sidebar Styling */
        .sidebar { width: 320px; height: 100vh; position: fixed; border-right: 1px solid rgba(0,0,0,0.05); background: rgba(255,255,255,0.8); backdrop-filter: blur(20px); padding: 40px 24px; z-index: 40; }
        .main-content { margin-left: 320px; padding: 180px 100px 100px 100px; max-width: 1400px; }
        
        /* Logo SCALED 2.5X */
        .logo-container { position: absolute; top: 40px; left: 50%; transform: translateX(-50%); z-index: 50; }
        .app-logo { height: 125px; width: auto; object-fit: contain; }

        /* Mode Grid Buttons */
        .mode-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .mode-card { 
            background: #fff; border: 1px solid #f0f0f0; padding: 24px; border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .mode-card:hover { border-color: #000; transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .mode-card.active { background: #000; border-color: #000; color: #fff; }
        .mode-title { font-weight: 600; font-size: 1.1rem; display: block; margin-top: 8px; }

        /* Textarea & Glass UI */
        .glass-input { 
            width: 100%; height: 400px; p-10; border-radius: 40px; border: 1px solid #f0f0f0; background: rgba(250, 250, 250, 0.5); backdrop-filter: blur(10px); 
            font-size: 1.5rem; outline: none; transition: 0.3s; padding: 40px; line-height: 1.6;
        }
        .glass-input:focus { border-color: #000; background: #fff; box-shadow: 0 0 0 10px rgba(0,0,0,0.02); }

        .btn-generate { 
            background: #000; color: #fff; padding: 24px 60px; border-radius: 20px; font-weight: 600; font-size: 1.2rem; transition: 0.3s;
        }
        .btn-generate:hover { transform: scale(1.02); background: #222; }

        /* Loader Animation */
        .loader-dots { display: flex; gap: 8px; justify-content: center; margin-top: 20px; }
        .dot { width: 12px; height: 12px; background: #ddd; border-radius: 50%; animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div class="logo-container">
        <img src="Clarity Logo.png" alt="Clarity" class="app-logo">
    </div>

    <aside class="sidebar flex flex-col">
        <div class="h-32"></div>
        <nav class="space-y-6 flex-1">
            <a href="index.html" class="flex items-center gap-4 font-bold text-black text-xl">
                <span>‚ú¶</span> New Session
            </a>
            <a href="saved.html" id="nav-saved" class="hidden flex items-center gap-4 text-gray-400 hover:text-black transition text-xl">
                <span>üìÅ</span> Archive
            </a>
        </nav>

        <div id="auth-section" class="pt-8 border-t border-gray-100">
            <button id="loginBtn" class="w-full flex items-center justify-center gap-3 p-4 border rounded-xl hover:bg-gray-50 transition font-semibold">
                <img src="GLogo.png" class="w-6 h-6"> Sign in
            </button>
            <div id="user-profile" class="hidden">
                <p class="text-xs text-gray-400 font-bold uppercase tracking-widest mb-1">Authenticated</p>
                <p id="display-name" class="font-bold text-xl text-black"></p>
                <button id="logoutBtn" class="text-sm text-red-500 hover:underline mt-2">Sign Out</button>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <h2 class="text-[6rem] font-medium tracking-tight leading-none mb-12">Make it <span class="text-gray-200">clear.</span></h2>

        <div class="mode-grid">
            <div class="mode-card active" data-mode="summary">
                <span class="text-3xl">üìñ</span>
                <span class="mode-title">Deep Dive</span>
            </div>
            <div class="mode-card" data-mode="speed">
                <span class="text-3xl">‚ö°</span>
                <span class="mode-title">Speed Review</span>
            </div>
            <div class="mode-card" data-mode="quiz">
                <span class="text-3xl">üß†</span>
                <span class="mode-title">Mastery Quiz</span>
            </div>
            <div class="mode-card" data-mode="vocab">
                <span class="text-3xl">üè∑Ô∏è</span>
                <span class="mode-title">Key Terms</span>
            </div>
        </div>

        <div id="quizCountContainer" class="hidden mb-12 bg-gray-50 p-8 rounded-3xl inline-block">
            <label class="block text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">Question Count: <span id="countVal" class="text-black">10</span></label>
            <input type="range" id="quizCount" min="5" max="20" value="10" class="w-64 accent-black cursor-pointer">
        </div>

        <textarea id="studyInput" class="glass-input mb-8" placeholder="Drop your notes here..."></textarea>
        
        <div class="flex justify-between items-center">
            <div id="status-box" class="text-sm font-bold uppercase tracking-widest text-gray-300">
                Ready to Process
            </div>
            <button id="generateBtn" class="btn-generate">Generate Magic</button>
        </div>

        <div id="outputArea" class="hidden mt-20 p-16 border-2 border-black rounded-[4rem] bg-white shadow-2xl transition-all duration-500">
            <div class="flex justify-between items-center mb-12">
                <h3 class="text-xs font-bold uppercase tracking-widest text-gray-300">Your AI Guide</h3>
                <div class="flex gap-8">
                    <button id="copyBtn" class="font-bold hover:text-blue-600 transition">Copy Text</button>
                    <button id="saveBtn" class="font-bold text-blue-600 hover:underline">Save to Archive</button>
                </div>
            </div>
            <div id="aiResult" class="prose prose-2xl max-w-none text-black leading-relaxed"></div>
        </div>
    </main>

    <script type="module">
        // [Firebase Logic remains the same, just updating UI hookups]
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG (Same as before)
        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentMode = 'summary';

        // Mode Grid Interactivity
        document.querySelectorAll('.mode-card').forEach(card => {
            card.onclick = () => {
                document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                currentMode = card.dataset.mode;
                
                // Show/Hide Quiz Slider
                const quizBox = document.getElementById('quizCountContainer');
                currentMode === 'quiz' ? quizBox.classList.remove('hidden') : quizBox.classList.add('hidden');
            };
        });

        document.getElementById('quizCount').oninput = (e) => document.getElementById('countVal').innerText = e.target.value;

        // AUTH & GENERATE (Logic same as previous version but using 'currentMode' variable)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('user-profile').classList.remove('hidden');
                document.getElementById('nav-saved').classList.remove('hidden');
                const userSnap = await getDoc(doc(db, "users", user.uid));
                if (userSnap.exists()) document.getElementById('display-name').innerText = userSnap.data().nickname;
            }
        });

        document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
        document.getElementById('logoutBtn').onclick = () => signOut(auth).then(() => window.location.reload());

        document.getElementById('generateBtn').onclick = async () => {
            const text = document.getElementById('studyInput').value;
            if(!text) return;
            const resArea = document.getElementById('aiResult');
            document.getElementById('outputArea').classList.remove('hidden');
            resArea.innerHTML = `<div class="loader-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, mode: currentMode, count: document.getElementById('quizCount').value })
                });
                const data = await res.json();
                resArea.innerText = data.result;
            } catch (e) { resArea.innerText = "Error generating content."; }
        };

        // SAVE & COPY buttons logic remains the same...
    </script>
</body>
</html>
