<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify | Clarity</title>
    <link rel="icon" href="Clarity Logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .otp-input { width: 3.5rem; height: 4.5rem; border: 2px solid #e2e8f0; border-radius: 1rem; text-align: center; font-size: 1.5rem; font-weight: 900; background: white; transition: all 0.2s; }
        .otp-input:focus { border-color: #6366f1; outline: none; ring: 4px; ring-color: #6366f110; }
        @media (max-width: 400px) { .otp-input { width: 2.8rem; height: 3.8rem; } }
    </style>
</head>
<body class="bg-[#f8fafc] min-h-screen flex items-center justify-center p-6">
    <div class="max-w-md w-full bg-white rounded-[3rem] p-10 md:p-14 shadow-2xl text-center border border-slate-100">
        <img src="Clarity Logo.png" class="h-20 mx-auto mb-8">
        <h1 class="text-3xl font-black mb-2 tracking-tighter">Check your Gmail.</h1>
        <p class="text-slate-500 font-bold mb-10">We sent a 6-digit security code to verify your account.</p>
        
        <div class="flex justify-between gap-2 mb-10" id="otp-wrap">
            <input type="text" maxlength="1" class="otp-input" autofocus>
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
            <input type="text" maxlength="1" class="otp-input">
        </div>

        <button id="verifyBtn" class="w-full bg-black text-white py-5 rounded-2xl font-black text-lg shadow-xl hover:scale-[1.02] transition">Verify Account</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const inputs = document.querySelectorAll('.otp-input');
        inputs.forEach((input, i) => {
            input.oninput = () => { if(input.value && i < 5) inputs[i+1].focus(); };
            input.onkeydown = (e) => { if(e.key === "Backspace" && !input.value && i > 0) inputs[i-1].focus(); };
        });

        document.getElementById('verifyBtn').onclick = async () => {
            const code = Array.from(inputs).map(i => i.value).join('');
            const user = auth.currentUser;
            if(!user) return;
            const snap = await getDoc(doc(db, "users", user.uid));
            if(snap.exists() && snap.data().tempCode === code) {
                await updateDoc(doc(db, "users", user.uid), { isVerified: true });
                window.location.href = "workspace.html";
            } else { alert("Wrong code!"); }
        };
    </script>
</body>
</html>
