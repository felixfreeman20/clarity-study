<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity | Verify Email</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .code-input { width: 50px; height: 64px; border: 2px solid #e2e8f0; border-radius: 16px; text-align: center; font-size: 1.5rem; font-weight: 800; transition: all 0.2s; background: white; }
        .code-input:focus { border-color: #6366f1; ring: 4px; ring-color: rgba(99, 102, 241, 0.1); outline: none; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
    <div class="max-w-md w-full bg-white rounded-[2.5rem] p-10 shadow-2xl text-center border border-slate-100">
        <div class="w-20 h-20 bg-indigo-50 text-indigo-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-8">✉️</div>
        <h1 class="text-3xl font-black tracking-tighter text-slate-900 mb-2">Check your email</h1>
        <p class="text-slate-500 font-medium mb-8">We sent a 6-digit security code to your inbox. Paste it below to secure your account.</p>
        
        <div class="flex justify-between gap-2 mb-10" id="otp-container">
            <input type="text" maxlength="1" class="code-input" autofocus>
            <input type="text" maxlength="1" class="code-input">
            <input type="text" maxlength="1" class="code-input">
            <input type="text" maxlength="1" class="code-input">
            <input type="text" maxlength="1" class="code-input">
            <input type="text" maxlength="1" class="code-input">
        </div>

        <button id="verifyBtn" class="w-full bg-black text-white py-5 rounded-2xl font-black text-lg shadow-xl hover:bg-slate-800 transition-all mb-6">Verify Account</button>
        
        <p class="text-sm font-bold text-slate-400">
            Didn't get the code? <button class="text-indigo-600 hover:underline">Resend code</button>
        </p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAoyilOSkLk7uQVC4znit855wfAwVXU3Uo", authDomain: "clarity-study-cd835.firebaseapp.com", projectId: "clarity-study-cd835", storageBucket: "clarity-study-cd835.firebasestorage.app", messagingSenderId: "92484724607", appId: "1:92484724607:web:d07cbc3f0238264ecf9c4a" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Auto-focus logic for inputs
        const inputs = document.querySelectorAll('.code-input');
        inputs.forEach((input, index) => {
            input.oninput = () => {
                if (input.value && index < inputs.length - 1) inputs[index + 1].focus();
            };
            input.onkeydown = (e) => {
                if (e.key === "Backspace" && !input.value && index > 0) inputs[index - 1].focus();
            };
        });

        document.getElementById('verifyBtn').onclick = async () => {
            const enteredCode = Array.from(inputs).map(i => i.value).join('');
            const user = auth.currentUser;

            if (user) {
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                
                if (snap.exists() && snap.data().tempCode === enteredCode) {
                    await updateDoc(userRef, { isVerified: true });
                    window.location.href = "workspace.html";
                } else {
                    alert("Incorrect code. Please check your email again.");
                }
            }
        };
    </script>
</body>
</html>
